{"status":{},"contains_secrets":true,"product_version":"2.9.0","spec":{"description":"This blueprint builds the CI\/CD pipeline deploying a private Docker registry, git repository, Artifactory instance, Jenkins Master, two Jenkins slaves and a developer workstation. Each of these components is tied together for seamless integration leveraging SSH keys and certificates. Calm configures the Jenkins Master with the necessary credentials to access the git repository, Artifactory, Docker registry and the Calm instance. A Karbon cluster is also configured to access the private Docker registry to pull the containers that are built via the Jenkins pipeline. Two jobs are preconfigured on the Jenkins master to handle the build and deployment of the application. The developer workstation is setup with a cloned but empty git repository. Sample application code is pre-staged on the workstation to enable quickly being able to add the code to git, commit and push it.","resources":{"client_attrs":{"8cafc62e_deployment_cloned_1":{"y":-255.1142895662,"x":-358.7870924921},"aa65c031_deployment_cloned_1":{"y":17.1602822234,"x":-162.1742151584},"None":{"y":-68.6240759861,"x":233.5880736589},"8cafc62e_deployment":{"y":-68.6240759861,"x":233.5880736589},"a0b9926e_deployment":{"y":337.1675396481,"x":622.8399018037},"fe95f237_deployment":{"y":262.3104958304,"x":39.0147129281},"1afa7711_deployment":{"y":-253,"x":35.4285714286},"aa65c031_deployment":{"y":128.8962033685,"x":433.3257471522}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure User"}],"name":"84e2678e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure User","attrs":{"exit_status":[],"script":"mkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho 'set -o vi' >> ~\/.bashrc\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\n\necho \"Create SSH Keys\"\necho \"@@{Nutanix.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/*\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a7befc49_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"84e2678e_dag"},"variable_list":[]},"name":"Artifactory Configure Connectivity"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Artifactory Configure Connectivity"}],"name":"6b546dea_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Artifactory Configure Connectivity","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"a7befc49_runbook_cloned_1"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"fb911f31_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"6b546dea_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"be256f71_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bed2d16c_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"be256f71_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"38cd3275_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d7e997fb_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"38cd3275_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bc0993e2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9b3a9a95_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"bc0993e2_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"04085076_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7f5595ea_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"04085076_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Docker"},{"kind":"app_task","name":"Install Docker Compose"}],"name":"88fffde0_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker Compose"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker","attrs":{"exit_status":[],"script":"echo \"** Install Required Packages...\"\nsudo yum install -y yum-utils\nsudo yum install -y epel-release.noarch\nsudo yum install -y httpd-tools\n\necho \"** Adding Docker Repo...\"\nsudo yum-config-manager --add-repo=https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\n\necho \"** Set apt-cache policy for docker-ce...\"\nsudo yum-config-manager --enable docker-ce-nightly\n\necho \"** Installing Docker CE...\"\nsudo yum install -y docker-ce\nsudo yum makecache fast\n\necho \"** Adding current user to docker group...\"\nsudo usermod -aG docker @@{Nutanix.username}@@\n\necho \"** Starting Docker CE...\"\nsudo service docker start\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker Compose","attrs":{"exit_status":[],"script":"echo \"** Installing python-pip...\"\nsudo yum install -y python-pip\n\necho \"** Upgrade pip...\"\nsudo pip install --upgrade pip\n\necho \"** Install docker-compose...\"\nsudo curl -L \"https:\/\/github.com\/docker\/compose\/releases\/download\/1.24.1\/docker-compose-$(uname -s)-$(uname -m)\" -o \/usr\/local\/bin\/docker-compose\nsudo chmod +x \/usr\/local\/bin\/docker-compose\nsudo ln -s \/usr\/local\/bin\/docker-compose \/usr\/bin\/docker-compose\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"350f897b_runbook","main_task_local_reference":{"kind":"app_task","name":"88fffde0_dag"},"variable_list":[]},"name":"Artifactory Docker Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Pull Artifactory Contianer"},{"kind":"app_task","name":"Start Artifactory"},{"kind":"app_task","name":"Configure Artifactory"}],"name":"20fc7eb7_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Pull Artifactory Contianer"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Start Artifactory"}},{"from_task_reference":{"kind":"app_task","name":"Start Artifactory"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Artifactory"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Pull Artifactory Contianer","attrs":{"exit_status":[],"script":"# Pull Artifactory container image\ndocker pull docker.bintray.io\/jfrog\/artifactory-oss:latest\n\nsleep 10\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Start Artifactory","attrs":{"exit_status":[],"script":"# Start the Artifactory container\ndocker run --name artifactory -d -p 8081:8081 docker.bintray.io\/jfrog\/artifactory-oss:latest\n\nsleep 60","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Artifactory","attrs":{"exit_status":[],"script":"echo \"Initialize Artifactory @@{initial_project_name}@@ Repository\"\n\necho 'localRepositories:\n  @@{initial_project_name}@@-local-repo:\n    type: generic\n    checksumPolicyType: server-generated-checksums\n    description: \"Devops @@{initial_project_name}@@ Artifact Repository\"\n    dockerApiVersion: V2\n    excludesPattern:\n    includesPattern:\n    maxUniqueSnapshots: 0\n    maxUniqueTags: 0\n    repoLayout: simple-default\n    snapshotVersionBehavior: unique\n    blackedOut: false\n    enableFileListsIndexing: false\n    forceNugetAuthentication: false\n    handleReleases: true\n    handleSnapshots: true\n    suppressPomConsistencyChecks: true' > ~\/artifactory-repo-config.yml\n \nsleep 90\n \ncurl -u admin:password -X PATCH \"http:\/\/localhost:8081\/artifactory\/api\/system\/configuration\" -H \u201cContent-Type:application\/yaml\u201d -T ~\/artifactory-repo-config.yml\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"af31aac3_runbook","main_task_local_reference":{"kind":"app_task","name":"20fc7eb7_dag"},"variable_list":[]},"name":"Artifactory Installation"}],"depends_on_list":[],"name":"Artifactory","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"artifact_server","value":"http:\/\/10.1.176.73\/artifacts","label":"","attrs":{"type":""},"is_hidden":false}],"description":""},{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure User"},{"kind":"app_task","name":"Load Cert"}],"name":"84e2678e_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Configure User"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Load Cert"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure User","attrs":{"exit_status":[],"script":"#chmod 700 ~\/.ssh\necho 'set -o vi' >> ~\/.bashrc\necho 'export DOCKER_REGISTRY=@@{Docker Registry.name}@@.@@{domain_name}@@' >> ~\/.bashrc\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\nchmod 600 ~\/.ssh\/config\n\necho \"Create SSH Keys\"\necho \"@@{Nutanix.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_rsa*\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Load Cert","attrs":{"exit_status":[],"script":"echo \"Create host entries\"\necho \"@@{Docker Registry.address}@@ @@{Docker Registry.name}@@.@@{domain_name}@@ @@{Docker Registry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Gitolite.address}@@ @@{Gitolite.name}@@.@@{domain_name}@@ @@{Gitolite.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Artifactory.address}@@ @@{Artifactory.name}@@.@@{domain_name}@@ @@{Artifactory.name}@@\" | sudo tee -a \/etc\/hosts\n\necho \"Load Cert\"\nREGISTRY_IP=@@{Docker Registry.address}@@\nscp -i ~\/.ssh\/id_rsa -oStrictHostKeyChecking=no ${REGISTRY_IP}:~\/devdockerCA.crt \/tmp\nsudo mv \/tmp\/devdockerCA.crt \/etc\/pki\/ca-trust\/source\/anchors\/\nsudo update-ca-trust\nsudo service docker restart","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a7befc49_runbook","main_task_local_reference":{"kind":"app_task","name":"84e2678e_dag"},"variable_list":[]},"name":"Developer Workstation Configure Connectivity"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Docker"},{"kind":"app_task","name":"Install Docker Compose"}],"name":"af15a349_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker Compose"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker","attrs":{"exit_status":[],"script":"echo \"** Install Required Packages...\"\nsudo yum install -y yum-utils\nsudo yum install -y epel-release.noarch\nsudo yum install -y httpd-tools\n\necho \"** Adding Docker Repo...\"\nsudo yum-config-manager --add-repo=https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\n\necho \"** Set apt-cache policy for docker-ce...\"\nsudo yum-config-manager --enable docker-ce-nightly\n\necho \"** Installing Docker CE...\"\nsudo yum install -y docker-ce\nsudo yum makecache fast\n\necho \"** Adding current user to docker group...\"\nsudo usermod -aG docker @@{Nutanix.username}@@\n\necho \"** Starting Docker CE...\"\nsudo service docker start\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker Compose","attrs":{"exit_status":[],"script":"echo \"** Installing python-pip...\"\nsudo yum install -y python-pip\n\necho \"** Upgrade pip...\"\nsudo pip install --upgrade pip\n\necho \"** Install docker-compose...\"\nsudo curl -L \"https:\/\/github.com\/docker\/compose\/releases\/download\/1.24.1\/docker-compose-$(uname -s)-$(uname -m)\" -o \/usr\/local\/bin\/docker-compose\nsudo chmod +x \/usr\/local\/bin\/docker-compose\nsudo ln -s \/usr\/local\/bin\/docker-compose \/usr\/bin\/docker-compose\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4d4b18fe_runbook","main_task_local_reference":{"kind":"app_task","name":"af15a349_dag"},"variable_list":[]},"name":"Developer Workstation Docker Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install NodeJS"}],"name":"ace9b0ce_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install NodeJS","attrs":{"exit_status":[],"script":"sudo yum install -y epel-release\nsudo yum install -y nodejs\nsudo yum install -y npm\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ffab2e14_runbook","main_task_local_reference":{"kind":"app_task","name":"ace9b0ce_dag"},"variable_list":[]},"name":"Developer Workstation NodeJS Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Initialize DevOps Repository"},{"kind":"app_task","name":"Download Version 1 Demo Code"}],"name":"501ff368_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Initialize DevOps Repository"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Download Version 1 Demo Code"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initialize DevOps Repository","attrs":{"exit_status":[],"script":"echo \"Initialize @@{initial_project_name}@@ Git Project\"\nsudo yum install -y git\n\ngit clone git@@@{Gitolite.name}@@.@@{domain_name}@@:@@{initial_project_name}@@.git\n\ncd @@{initial_project_name}@@\n\ngit config user.name @@{Nutanix.username}@@\ngit config user.email @@{Nutanix.username}@@@@@{name}@@.@@{domain_name}@@\ngit config --global push.default matching\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Download Version 1 Demo Code","attrs":{"exit_status":[],"script":"echo \"Get Demo Code\"\nsudo yum install -y wget\ncd @@{initial_project_name}@@\nwget @@{initial_code_seed_location}@@\/@@{initial_code_seed}@@\ntar xvfz @@{initial_code_seed}@@\nrm @@{initial_code_seed}@@\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"e45c29cd_runbook","main_task_local_reference":{"kind":"app_task","name":"501ff368_dag"},"variable_list":[]},"name":"Developer Workstation Setup Demo Project"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Developer Workstation Configure Connectivity"},{"kind":"app_task","name":"Developer Workstation Setup Demo Project"}],"name":"6b546dea_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Developer Workstation Configure Connectivity"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Developer Workstation Setup Demo Project"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Developer Workstation Configure Connectivity","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"a7befc49_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Developer Workstation Setup Demo Project","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"e45c29cd_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"fb911f31_runbook","main_task_local_reference":{"kind":"app_task","name":"6b546dea_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"be256f71_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bed2d16c_runbook","main_task_local_reference":{"kind":"app_task","name":"be256f71_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"38cd3275_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d7e997fb_runbook","main_task_local_reference":{"kind":"app_task","name":"38cd3275_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bc0993e2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9b3a9a95_runbook","main_task_local_reference":{"kind":"app_task","name":"bc0993e2_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"04085076_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7f5595ea_runbook","main_task_local_reference":{"kind":"app_task","name":"04085076_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install kubectl"},{"kind":"app_task","name":"Install JQ"}],"name":"d2e9c52b_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install kubectl"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install JQ"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install kubectl","attrs":{"exit_status":[],"script":"echo \"[kubernetes]\nname=Kubernetes\nbaseurl=https:\/\/packages.cloud.google.com\/yum\/repos\/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https:\/\/packages.cloud.google.com\/yum\/doc\/yum-key.gpg https:\/\/packages.cloud.google.com\/yum\/doc\/rpm-package-key.gpg\" | sudo tee \/etc\/yum.repos.d\/kubernetes.repo\n\nsudo yum install -y kubectl\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install JQ","attrs":{"exit_status":[],"script":"echo \"** Install JQ...\"\nsudo yum install -y jq","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ce76be5f_runbook","main_task_local_reference":{"kind":"app_task","name":"d2e9c52b_dag"},"variable_list":[]},"name":"Developer Workstation Kubectl Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Get KUBECONFIG"},{"kind":"app_task","name":"Delete K8s Credential"}],"name":"330df67a_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Get KUBECONFIG"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Delete K8s Credential"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get KUBECONFIG","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n# Set authentication cookie\necho \"Set Cookie for Karbon Authentication\"\ncurl -u @@{Prism Central User.username}@@:@@{Prism Central User.secret}@@ -c cookiefile -X POST -H \"Content-Type: application\/json\" -d '{}' -k https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/clusters\/list\n\n# Get Karbon cluster UUID\necho \"Get Karbon Cluster UUID\"\nkarbon_uuid=$(curl -b cookiefile -X POST -k https:\/\/@@{pc_instance_ip}@@:7050\/acs\/k8s\/cluster\/list | jq -r '[ .[].cluster_metadata | select( .name | contains(\"@@{karbon_cluster_name}@@\")) ]' | jq -r '.[].uuid')\n\n# Get kubeconfig\necho \"Get Karbon Cluster KUBECONFIG\"\ncurl -b cookiefile -X GET -H \"Content-Type: application\/json\" -k https:\/\/@@{pc_instance_ip}@@:7050\/acs\/k8s\/cluster\/${karbon_uuid}\/kubeconfig | jq -r '.yml_config' | base64 --decode > kubeconfig.yml\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Delete K8s Credential","attrs":{"exit_status":[],"script":"export KUBECONFIG=kubeconfig.yml\n\necho \"Check creds...\"\nkubectl get secrets -n @@{yourname}@@\n\necho \"Delete docker-registry-cred\"\nkubectl delete secret docker-registry-cred-@@{Docker Registry.app_name}@@ -n @@{yourname}@@","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"60fc2582_runbook","main_task_local_reference":{"kind":"app_task","name":"330df67a_dag"},"variable_list":[]},"name":"Developer Workstation K8s Clean Up"}],"depends_on_list":[{"kind":"app_service","name":"Jenkins Slave"}],"name":"Developer Workstation","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Docker"},{"kind":"app_task","name":"Install Docker Compose"}],"name":"c046787c_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker Compose"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker","attrs":{"exit_status":[],"script":"echo \"** Install Required Packages...\"\nsudo yum install -y yum-utils\nsudo yum install -y epel-release.noarch\nsudo yum install -y httpd-tools\n\necho \"** Adding Docker Repo...\"\nsudo yum-config-manager --add-repo=https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\n\necho \"** Set apt-cache policy for docker-ce...\"\nsudo yum-config-manager --enable docker-ce-nightly\n\necho \"** Installing Docker CE...\"\nsudo yum install -y docker-ce\nsudo yum makecache fast\n\necho \"** Adding current user to docker group...\"\nsudo usermod -aG docker @@{Nutanix.username}@@\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker Compose","attrs":{"exit_status":[],"script":"echo \"** Installing python-pip...\"\nsudo yum install -y python-pip\n\necho \"** Upgrade pip...\"\nsudo pip install --upgrade pip\n\necho \"** Install docker-compose...\"\nsudo curl -L \"https:\/\/github.com\/docker\/compose\/releases\/download\/1.24.1\/docker-compose-$(uname -s)-$(uname -m)\" -o \/usr\/local\/bin\/docker-compose\nsudo chmod +x \/usr\/local\/bin\/docker-compose\nsudo ln -s \/usr\/local\/bin\/docker-compose \/usr\/bin\/docker-compose\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"991aa9e9_runbook","main_task_local_reference":{"kind":"app_task","name":"c046787c_dag"},"variable_list":[]},"name":"Docker Registry Docker Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Docker Registry"},{"kind":"app_task","name":"Setup Init Service"},{"kind":"app_task","name":"Configure Cert"}],"name":"42c7adc3_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Docker Registry"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Setup Init Service"}},{"from_task_reference":{"kind":"app_task","name":"Setup Init Service"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Cert"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker Registry","attrs":{"exit_status":[],"script":"sudo yum install -y httpd-utils\n\necho \"Creating docker-registry directory...\"\nsudo mkdir -p \/docker-registry\/data \nsudo mkdir -p \/docker-registry\/nginx\n\necho \"Creating docker-registry.yml file...\"\necho 'nginx:\n  image: \"nginx:1.9\"\n  ports:\n    - 443:443\n  links:\n    - registry:registry\n  volumes:\n    - .\/nginx\/:\/etc\/nginx\/conf.d\nregistry:\n  image: registry:2\n  ports:\n    - 127.0.0.1:5000:5000\n  environment:\n    REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: \/data\n  volumes:\n    - .\/data:\/data' | sudo tee \/docker-registry\/docker-compose.yml\n\necho 'upstream docker-registry {\n  server registry:5000;\n}\n\nserver {\n  listen 443;\n  server_name @@{name}@@.@@{domain_name}@@;\n\n  # SSL\n  ssl on;\n  ssl_certificate \/etc\/nginx\/conf.d\/domain.crt;\n  ssl_certificate_key \/etc\/nginx\/conf.d\/domain.key;\n\n  # disable any limits to avoid HTTP 413 for large image uploads\n  client_max_body_size 0;\n\n  # required to avoid HTTP 411: see Issue #1486 (https:\/\/github.com\/docker\/docker\/issues\/1486)\n  chunked_transfer_encoding on;\n\n  location \/v2\/ {\n    # Do not allow connections from docker 1.5 and earlier\n    if ($http_user_agent ~ \"^(docker\\\/1\\.(3|4|5(?!\\.[0-9]-dev))|Go ).*$\" ) {\n      return 404;\n    }\n\n    # To add basic authentication to v2 use auth_basic setting plus add_header\n    auth_basic \"registry.localhost\";\n    auth_basic_user_file \/etc\/nginx\/conf.d\/registry.password;\n    add_header \"Docker-Distribution-Api-Version\" \"registry\/2.0\" always;\n\n    proxy_pass                          http:\/\/docker-registry;\n    proxy_set_header  Host              $http_host;   \n    proxy_set_header  X-Real-IP         $remote_addr; \n    proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;\n    proxy_set_header  X-Forwarded-Proto $scheme;\n    proxy_read_timeout                  900;\n  }\n}' | sudo tee \/docker-registry\/nginx\/registry.conf\n\necho \"Create Docker Cert\"\necho @@{Docker Registry Credential.secret}@@ | sudo htpasswd -ci \/docker-registry\/nginx\/registry.password @@{Docker Registry Credential.username}@@ \n\nsudo openssl genrsa -out \/docker-registry\/nginx\/devdockerCA.key 2048\n\nsudo openssl req -x509 -new -nodes -key \/docker-registry\/nginx\/devdockerCA.key -days 10000 -out \/docker-registry\/nginx\/devdockerCA.crt -subj \"\/C=US\/ST=California\/L=San Jose\/O=nutnaix\/OU=DevOps\/CN=@@{name}@@.@@{domain_name}@@\/emailAddress=''\"\n\nsudo openssl genrsa -out \/docker-registry\/nginx\/domain.key 2048\n\nsudo openssl req -new -key \/docker-registry\/nginx\/domain.key -out \/docker-registry\/nginx\/dev-docker-registry.com.csr -subj \"\/C=US\/ST=California\/L=San Jose\/O=nutnaix\/OU=DevOps\/CN=@@{name}@@.@@{domain_name}@@\/emailAddress=''\"\n\nsudo openssl x509 -req -in \/docker-registry\/nginx\/dev-docker-registry.com.csr -CA \/docker-registry\/nginx\/devdockerCA.crt -CAkey \/docker-registry\/nginx\/devdockerCA.key -CAcreateserial -out \/docker-registry\/nginx\/domain.crt -days 10000\n\nsudo cp \/docker-registry\/nginx\/devdockerCA.crt \/etc\/pki\/ca-trust\/source\/anchors\/\nsudo update-ca-trust\n\necho \"Restart Docker Service\"\nsudo service docker restart\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup Init Service","attrs":{"exit_status":[],"script":"echo \"Creating Init Script\"\n\necho '[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https:\/\/docs.docker.com\nAfter=network-online.target firewalld.service\nWants=network-online.target\n\n[Service]\nType=notify\n# the default is not to use systemd for cgroups because the delegate issues still\n# exists and systemd currently does not support the cgroup feature set required\n# for containers run by docker\nExecStart=\/usr\/bin\/docker-compose -f \/docker-registry\/docker-compose.yml up -d\nExecReload=\/bin\/kill -s HUP $MAINPID\nLimitNOFILE=1048576\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\n# Uncomment TasksMax if your systemd version supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nTimeoutStartSec=0\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\n# restart the docker process if it exits prematurely\nRestart=on-failure\nStartLimitBurst=3\nStartLimitInterval=60s\n\n[Install]\nWantedBy=multi-user.target' | sudo tee \/etc\/systemd\/system\/docker-registry.service \n\necho \"Starting docker-registry Service\"\nsudo service docker-registry start\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Cert","attrs":{"exit_status":[],"script":"mkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho \"@@{Nutanix.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/*\nsudo cp \/docker-registry\/nginx\/devdockerCA.crt ~\/\nsudo chown @@{Nutanix.username}@@:@@{Nutanix.username}@@ ~\/devdockerCA.crt\nchmod 600 ~\/devdockerCA.crt\necho \"set -o vi\" >> ~\/.bashrc","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6a6ef171_runbook","main_task_local_reference":{"kind":"app_task","name":"42c7adc3_dag"},"variable_list":[]},"name":"Docker Registry Installation"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ae5e6af0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"af3d1fe3_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"ae5e6af0_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e92443c7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"555be4c9_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"e92443c7_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"00c19b6d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"04de4a48_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"00c19b6d_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"117602e2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ccc2a1d7_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"117602e2_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6e79884f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d6f485c8_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"6e79884f_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Required Packages"},{"kind":"app_task","name":"Setup Certs on Karbon Nodes"}],"name":"5fab1ee6_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Required Packages"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Setup Certs on Karbon Nodes"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Required Packages","attrs":{"exit_status":[],"script":"echo \"** Install JQ...\"\nsudo yum install -y jq\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup Certs on Karbon Nodes","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n# Set authentication cookie\necho \"Set Cookie for Karbon Authentication\"\ncurl -u @@{Prism Central User.username}@@:@@{Prism Central User.secret}@@ -c cookiefile -X POST -H \"Content-Type: application\/json\" -d '{}' -k https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/clusters\/list\n\n# Get Karbon cluster UUID\necho \"Get Karbon Cluster UUID\"\nkarbon_uuid=$(curl -b cookiefile -X POST -k https:\/\/@@{pc_instance_ip}@@:7050\/acs\/k8s\/cluster\/list | jq -r '[ .[].cluster_metadata | select( .name | match(\"(^@@{karbon_cluster_name}@@$)\")) ]' | jq -r '.[].uuid')\n\n# Get kubeconfig\necho \"Get Karbon Cluster KUBECONFIG\"\ncurl -b cookiefile -X GET -H \"Content-Type: application\/json\" -k https:\/\/@@{pc_instance_ip}@@:7050\/acs\/k8s\/cluster\/${karbon_uuid}\/kubeconfig | jq -r '.yml_config' | base64 --decode > kubeconfig.yml\n\n# Get SSH Access\ncurl -b cookiefile -X GET -k https:\/\/@@{pc_instance_ip}@@:7050\/acs\/k8s\/cluster\/${karbon_uuid}\/node_ssh | jq -r '.access_script' | base64 --decode | sed '54,61d' > sshaccess.bash\n\n# Get master and worker node IPs\necho \"Get master and worker Node IPs\"\nip_json=$(curl -b cookiefile -X POST -k https:\/\/@@{pc_instance_ip}@@:7050\/acs\/k8s\/cluster\/list | jq -r '[ .[].cluster_metadata | select( .name | match(\"(^@@{karbon_cluster_name}@@$)\")) ]' | jq -r '.[] | to_entries | map(select(.key | match(\"k8s_config\";\"i\"))) | map(.value)')\nip_addresses=$(echo $ip_json | jq -r '.[].masters[].resource_config.ip_address')\n\nip_addresses+=\" $(echo $ip_json | jq -r '.[].workers[].resource_config.ip_address')\"\n\necho \"Print IPs\"\necho  \"IP Array: ${ip_addresses[@]}\"\nfor ip in ${ip_addresses[@]}\ndo \n    echo $ip\ndone\n\n# Set SSH Access\nbash sshaccess.bash\n\n\nKARBON_CERT=`ls \/tmp\/ | grep KARBON | grep -v '\\-cert.pub'`\necho \"Karbon Cert File: $KARBON_CERT\"\n\nfor ip in ${ip_addresses[@]}\ndo \n    ls\n    echo \"Copy Cert to $ip\"\n    scp -i \/tmp\/$KARBON_CERT -oStrictHostKeyChecking=no ~\/devdockerCA.crt @@{Nutanix.username}@@@${ip}:~\/\n    echo \"Move Cert to trust directory\"\n    ssh -i \/tmp\/$KARBON_CERT @@{Nutanix.username}@@@${ip} 'echo @@{Karbon Node.secret}@@ | sudo -S mv ~\/devdockerCA.crt \/etc\/pki\/ca-trust\/source\/anchors\/devdockerCA-@@{calm_application_uuid}@@.crt'\n    echo \"Update cert trusts\"\n    ssh -i \/tmp\/$KARBON_CERT @@{Nutanix.username}@@@${ip} 'echo @@{Karbon Node.secret}@@ | sudo -S update-ca-trust'\n    sleep 3\n    echo \"Restart docker service\"\n    ssh -i \/tmp\/$KARBON_CERT @@{Nutanix.username}@@@${ip} 'echo @@{Karbon Node.secret}@@ | sudo -S \/bin\/systemctl restart docker.service'\n    sleep 3\n    echo \"Add docker registy FQDN to hosts file\"\n    ssh -i \/tmp\/$KARBON_CERT @@{Nutanix.username}@@@${ip} 'echo @@{Karbon Node.secret}@@ | sudo -S su -c \"echo '@@{address}@@ @@{name}@@.@@{domain_name}@@ @@{name}@@' >> \/etc\/hosts\" -'\ndone\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6863c6ee_runbook","main_task_local_reference":{"kind":"app_task","name":"5fab1ee6_dag"},"variable_list":[]},"name":"Docker Registry Add Certs to Karbon"}],"depends_on_list":[],"name":"Docker Registry","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure Project Access"},{"kind":"app_task","name":"Init Demo Repository"}],"name":"7a9c8308_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Configure Project Access"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Init Demo Repository"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Project Access","attrs":{"exit_status":[],"script":"\necho \"Create Key File\"\necho @@{jenkins_public_key}@@ >> ~\/gitolite-admin\/keydir\/jenkins.pub \n\necho \"Configure @@{initial_project_name}@@ Repository Access\"\necho \"repo @@{initial_project_name}@@\" >> ~\/gitolite-admin\/conf\/gitolite.conf\necho \"    RW+     =   @all\" >> ~\/gitolite-admin\/conf\/gitolite.conf \necho \"    R       =   jenkins\" >> ~\/gitolite-admin\/conf\/gitolite.conf \n\necho \"Check IN and Commit Changes\"\ncd gitolite-admin\ngit add keydir\/jenkins.pub\ngit add keydir\/nutanix.pub\ngit add conf\/gitolite.conf\ngit config --global user.name nutanix\ngit config --global user.email nutanix@gso.lab\ngit config --global push.default matching\ngit commit -m \"Initial Commit.\"\ngit push origin master\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Init Demo Repository","attrs":{"exit_status":[],"script":"echo \"Create and Configure Repository\"\nsudo su -c 'mkdir ~\/repositories\/devops.git' - git\nsudo su -c 'cd ~\/repositories\/devops.git && git init --bare' - git\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"45466435_runbook","main_task_local_reference":{"kind":"app_task","name":"7a9c8308_dag"},"variable_list":[]},"name":"Gitolite Configure Demo Project"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Gitolite Configure Demo Project"}],"name":"721b691f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Gitolite Configure Demo Project","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"45466435_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"46a5a223_runbook","main_task_local_reference":{"kind":"app_task","name":"721b691f_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"629e64e1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b5d382ab_runbook","main_task_local_reference":{"kind":"app_task","name":"629e64e1_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a8bbd555_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ff208061_runbook","main_task_local_reference":{"kind":"app_task","name":"a8bbd555_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"f318fc86_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"1f3c5465_runbook","main_task_local_reference":{"kind":"app_task","name":"f318fc86_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"343c4dea_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"35a13bd5_runbook","main_task_local_reference":{"kind":"app_task","name":"343c4dea_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Gitolite"}],"name":"c8a23c68_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Gitolite","attrs":{"exit_status":[],"script":"echo \"Install git...\"\nsudo yum install -y perl-CPAN\nsudo yum install -y git\n\necho 'set -o vi' >> ~\/.bashrc\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\n\necho \"Create SSH Keys\"\necho \"@@{Nutanix.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\nchmod 700 ~\/.ssh\ncp ~\/.ssh\/id_rsa.pub ~\/.ssh\/authorized_keys\ncp ~\/.ssh\/id_rsa.pub \/tmp\/nutanix.pub\nchmod 600 ~\/.ssh\/*\nchmod 644 \/tmp\/nutanix.pub\n\necho \"Create git user...\"\nsudo adduser --system --shell \/bin\/bash -d \/home\/git -m git\nsudo passwd -l git\n\necho \"Configure git user home dir...\"\nsudo su -c 'mkdir ~\/bin; chmod 750 ~\/bin' - git\nsudo su -c 'echo \"PATH=$PATH:~\/bin\" >> ~\/.profile' - git\nsudo su -c 'echo \"set -o vi\" >> ~\/.bashrc' - git\n\necho \"Clone Gitolite repo...\"\nsudo su -c 'git clone https:\/\/github.com\/sitaramc\/gitolite' - git\n\necho \"Install Gitolite...\"\nsudo su -c 'gitolite\/install -ln' - git\n\necho \"Setup public key...\"\nsudo su -c 'gitolite setup -pk \/tmp\/nutanix.pub' - git\n#rm \/tmp\/nutanix.pub\n\necho \"Clone Gitolite Admin repo...\"\ngit clone git@@@{address}@@:gitolite-admin.git\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a89a99a1_runbook","main_task_local_reference":{"kind":"app_task","name":"c8a23c68_dag"},"variable_list":[]},"name":"Gitolite Installation"}],"depends_on_list":[],"name":"Gitolite","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Setup SSH"}],"name":"0c7134af_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup SSH","attrs":{"exit_status":[],"script":"chmod 700 ~\/.ssh\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\necho \"set -o vi\" >> ~\/.bashrc\n\necho \"Create SSH Keys\"\necho \"@@{Nutanix.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\ncp ~\/.ssh\/id_rsa.pub  ~\/.ssh\/authorized_keys\nchmod 600 ~\/.ssh\/*\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"7ea304d1_runbook","main_task_local_reference":{"kind":"app_task","name":"0c7134af_dag"},"variable_list":[]},"name":"Jenkins Master Configure Base User"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Get Initial Authorization Password"},{"kind":"app_task","name":"Install Jenkins CLI"},{"kind":"app_task","name":"Install Plugins"},{"kind":"app_task","name":"Create Jenkins Credential"},{"kind":"app_task","name":"Create Prism Central Credential"}],"name":"d917d896_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Get Initial Authorization Password"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Jenkins CLI"}},{"from_task_reference":{"kind":"app_task","name":"Install Jenkins CLI"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Plugins"}},{"from_task_reference":{"kind":"app_task","name":"Install Plugins"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Jenkins Credential"}},{"from_task_reference":{"kind":"app_task","name":"Create Jenkins Credential"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Prism Central Credential"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get Initial Authorization Password","attrs":{"exit_status":[],"script":"echo \"-------------------------\"\necho \"\"\necho \"Initial Authorization Password:\"\necho $(sudo cat \/var\/lib\/jenkins\/secrets\/initialAdminPassword)\necho \"\"\necho \"-------------------------\"\necho \"jenkins_authorization=\"$(sudo cat \/var\/lib\/jenkins\/secrets\/initialAdminPassword)\necho \"\"\n\n\nsleep 60","eval_variables":["jenkins_authorization"],"eval_scope":"local","script_type":"sh","type":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Jenkins CLI","attrs":{"exit_status":[],"script":"sleep 60\n\necho \"Install Jenkins CLI\"\nsudo wget http:\/\/@@{address}@@:8080\/jnlpJars\/jenkins-cli.jar\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Plugins","attrs":{"exit_status":[],"script":"echo \"Install Jenkins Plugins\"\necho \"http:\/\/@@{address}@@:8080\"\necho \"admin:@@{jenkins_authorization}@@\"\n\n#sudo java -jar jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 install-plugin -deploy authentication-tokens script-security bouncycastle-api http_request jackson2-api jquery-detached jsch ldap mapdb-api momentjs pam-auth nutanix-calm credentials plain-credentials resource-disposer scm-api ssh-credentials ssh-slaves structs subversion timestamper token-macro workflow-api workflow-basic-steps workflow-cps workflow-durable-task-step workflow-job workflow-multibranch workflow-scm-step workflow-step-api workflow-support docker-workflow handlebars docker-commons pipeline-milestone-step pipeline-input-step pipeline-stage-step pipeline-graph-analysis pipeline-rest-api pipeline-stage-view pipeline-build-step pipeline-model-api pipeline-model-extensions workflow-cps-global-lib pipeline-stage-tags-metadata pipeline-model-declarative-agent pipeline-model-definition lockable-resources workflow-aggregator credentials-binding git git-client git-server swarm cloudbees-folder cloudbees-credentials -restart\n  sudo java -jar jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 install-plugin -deploy authentication-tokens script-security bouncycastle-api http_request jackson2-api jquery-detached jsch          mapdb-api momentjs                   nutanix-calm credentials plain-credentials resource-disposer scm-api ssh-credentials ssh-slaves structs                     timestamper token-macro workflow-api workflow-basic-steps workflow-cps workflow-durable-task-step workflow-job workflow-multibranch workflow-scm-step workflow-step-api workflow-support docker-workflow handlebars docker-commons pipeline-milestone-step pipeline-input-step pipeline-stage-step pipeline-graph-analysis pipeline-rest-api pipeline-stage-view pipeline-build-step pipeline-model-api pipeline-model-extensions workflow-cps-global-lib pipeline-stage-tags-metadata pipeline-model-declarative-agent pipeline-model-definition lockable-resources workflow-aggregator credentials-binding git git-client git-server swarm cloudbees-folder cloudbees-credentials -restart","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Jenkins Credential","attrs":{"exit_status":[],"script":"echo 'Wait for Jenkins Instance Restart'\nsleep 60\n\necho 'Create Jenkins Credential'\nJENKINS_SSH_KEY=$(sudo cat \/var\/lib\/jenkins\/.ssh\/id_rsa)\n\necho '<com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey plugin=\"ssh-credentials@1.13\">\n  <scope>GLOBAL<\/scope>\n  <id>Jenkins<\/id>\n  <description><\/description>\n  <username>jenkins<\/username>\n  <privateKeySource class=\"com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey$DirectEntryPrivateKeySource\">\n    <privateKey>@@{Nutanix.secret}@@<\/privateKey>\n  <\/privateKeySource>\n<\/com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey>' | sudo java -jar jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 create-credentials-by-xml system::system::jenkins _\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Prism Central Credential","attrs":{"exit_status":[],"script":"echo \"Creating Prism Central User credential\"\necho '<com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>\n  <scope>GLOBAL<\/scope>\n  <id>PC-User<\/id>\n  <description>Prism Central User<\/description>\n  <username>@@{Prism Central User.username}@@<\/username>\n  <password>@@{Prism Central User.secret}@@<\/password>\n<\/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>' | sudo java -jar \/home\/nutanix\/jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 create-credentials-by-xml system::system::jenkins _ \n\nsudo systemctl restart jenkins.service\nsleep 60\nsudo usermod -s \/bin\/false jenkins","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4709f4a9_runbook","main_task_local_reference":{"kind":"app_task","name":"d917d896_dag"},"variable_list":[]},"name":"Configure Jenkins Master"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Hook"}],"name":"660dda49_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Hook","attrs":{"exit_status":[],"script":"echo 'StrictHostKeyChecking no' > ~\/.ssh\/config\nchmod 600 ~\/.ssh\/*\necho \"Create Hook\"\nssh @@{Gitolite.address}@@ 'printf \"#!\/bin\/bash\\n\/usr\/bin\/curl --user admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080\/job\/@@{initial_project_name}@@\/buildWithParameters?token=ThisIsTheAPITokenToUse\\n\" | sudo su -c \"tee ~\/repositories\/@@{initial_project_name}@@.git\/hooks\/post-receive\" - git'\nssh @@{Gitolite.address}@@ 'sudo su -c \"chmod 775 ~\/repositories\/@@{initial_project_name}@@.git\/hooks\/post-receive\" - git'\necho \"Complete Hook\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6f9a7f95_runbook","main_task_local_reference":{"kind":"app_task","name":"660dda49_dag"},"variable_list":[]},"name":"Jenkins Master Create Git Hook"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Initial Config"}],"name":"5e34fed4_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Initial Config","attrs":{"exit_status":[],"script":"echo 'Update Jenkins Configuration'\nsudo su -c \"sed -i 's\/<installStateName>NEW<\/<installStateName>RUNNING<\/' ~\/config.xml\" - jenkins\nsudo su -c \"sed -i 's\/numExecutors>2<\/numExecutors>0<\/' ~\/config.xml\" - jenkins\n\necho 'Create Location Configuration'\nprintf \"<?xml version='1.1' encoding='UTF-8'?>\n<jenkins.model.JenkinsLocationConfiguration>\n  <jenkinsUrl>http:\/\/@@{address}@@:8080\/<\/jenkinsUrl>\n<\/jenkins.model.JenkinsLocationConfiguration>\" | sudo su -c 'tee ~\/jenkins.model.JenkinsLocationConfiguration.xml' - jenkins\n\necho 'Set State and Version Configurations'\nsudo cat \/var\/lib\/jenkins.install.UpgradeWizard.state | sudo su -c 'tee ~\/jenkins.install.InstallUtil.lastExecVersion' - jenkins\n\necho 'Configure SSH'\nprintf \"<?xml version='1.1' encoding='UTF-8'?>\n<org.jenkinsci.main.modules.sshd.SSHD>\n  <port>22<\/port>\n<\/org.jenkinsci.main.modules.sshd.SSHD>\" | sudo su -c 'tee ~\/org.jenkinsci.main.modules.sshd.SSHD.xml' - jenkins\n\necho 'Create @@{initial_project_name}@@ Pipeline'\nsudo su -c 'mkdir -p ~\/jobs\/@@{initial_project_name}@@\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/@@{initial_project_name}@@\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/@@{initial_project_name}@@\/nextBuildNumber' - jenkins\n\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY_USER<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry Credential.username}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.PasswordParameterDefinition>\n          <name>DOCKER_REGISTRY_PASSWORD<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry Credential.secret}@@<\/defaultValue>\n        <\/hudson.model.PasswordParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry.name}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue>@@{initial_project_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>ARTIFACTORY_INSTANCE<\/name>\n          <description><\/description>\n          <defaultValue>@@{Artifactory.name}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <scm class=\"hudson.plugins.git.GitSCM\" plugin=\"git@3.9.1\">\n      <configVersion>2<\/configVersion>\n      <userRemoteConfigs>\n        <hudson.plugins.git.UserRemoteConfig>\n          <url>git@@@{Gitolite.name}@@.@@{domain_name}@@:@@{initial_project_name}@@.git<\/url>\n          <credentialsId>Jenkins<\/credentialsId>\n        <\/hudson.plugins.git.UserRemoteConfig>\n      <\/userRemoteConfigs>\n      <branches>\n        <hudson.plugins.git.BranchSpec>\n          <name>*\/master<\/name>\n        <\/hudson.plugins.git.BranchSpec>\n      <\/branches>\n      <doGenerateSubmoduleConfigurations>false<\/doGenerateSubmoduleConfigurations>\n      <submoduleCfg class=\"list\"\/>\n      <extensions\/>\n    <\/scm>\n    <scriptPath>Jenkinsfile<\/scriptPath>\n    <lightweight>true<\/lightweight>\n  <\/definition>\n  <triggers\/>\n  <authToken>ThisIsTheAPITokenToUse<\/authToken>\n  <disabled>false<\/disabled>\n<\/flow-definition>' | sudo su -c 'tee ~\/jobs\/@@{initial_project_name}@@\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@\/builds\/legacyIds' - jenkins\n\necho 'Setup Script Approvals'\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<scriptApproval plugin=\"script-security@1.44\">\n  <approvedScriptHashes\/>\n  <approvedSignatures>\n    <string>method groovy.json.JsonSlurperClassic parseText java.lang.String<\/string>\n    <string>method java.util.Map remove java.lang.Object<\/string>\n    <string>new groovy.json.JsonSlurperClassic<\/string>\n    <string>new java.util.HashMap java.util.Map<\/string>\n  <\/approvedSignatures>\n  <aclApprovedSignatures\/>\n  <approvedClasspathEntries\/>\n  <pendingScripts\/>\n  <pendingSignatures\/>\n  <pendingClasspathEntries\/>\n<\/scriptApproval>' | sudo su -c 'tee ~\/scriptApproval.xml' - jenkins\n\necho \"Create @@{initial_project_name}@@ App Deploy Job\"\nsudo su -c 'mkdir -p ~\/jobs\/@@{initial_project_name}@@_deploy\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/@@{initial_project_name}@@_deploy\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/@@{initial_project_name}@@_deploy\/nextBuildNumber' - jenkins\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>ARTIFACTORY_IP<\/name>\n          <description><\/description>\n          <defaultValue>@@{Artifactory.address}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry.name}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>BUILD_NUMBER<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>APP_NAME<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry.app_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <script>import groovy.json.JsonSlurperClassic\nimport groovy.json.JsonOutput\n\nnode() {\n    stage(&apos;Deploy Application Via Calm&apos;){\n        echo &quot;Application deployment visual&quot;\n    }\n}\n\ndef response = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: false, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;]], ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@&apos;\n\nprintln(&quot;Status: &quot; + response.status)\n\/\/println(&quot;Content: &quot; + response.content)\n\ndef blueprint_spec = parseJSON(response.content)\ndef bp_index = 0\ndef var_index = 0\nblueprint_spec.remove(&apos;status&apos;)\nblueprint_spec[&apos;spec&apos;].remove(&apos;name&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;application_name&apos;] = REPO_NAME + &apos;@@{calm_random}@@Jenkins&apos; + BUILD_NUMBER.toString()\nblueprint_spec[&apos;spec&apos;][&apos;app_profile_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;app_profile&quot;, &quot;uuid&quot;: &quot;@@{app_profile_uuid}@@&quot;}&apos;)\nblueprint_spec[&apos;metadata&apos;][&apos;owner_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;user&quot;, &quot;uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;, &quot;name&quot;: &quot;admin&quot;}&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;].each  { profileKey, profileRow -&gt; \n    println(&quot;Profile: ${profileKey}&quot;); \n    profileKey[&apos;variable_list&apos;].each { variableKey, variableRow -&gt;\n        println(&quot;Variable: ${variableKey}&quot;); \n        if (variableKey[&apos;name&apos;] == &apos;build_number&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = BUILD_NUMBER.toString()\n        } else if (variableKey[&apos;name&apos;] == &apos;project_name&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = REPO_NAME\n        } else if (variableKey[&apos;name&apos;] == &apos;artifactory_ip&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = ARTIFACTORY_IP\n        } else if (variableKey[&apos;name&apos;] == &apos;docker_registry&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = DOCKER_REGISTRY\n        } else if (variableKey[&apos;name&apos;] == &apos;app_name&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = APP_NAME\n        }\n        var_index += 1;\n    }; \n    bp_index += 1;\n}\n\/\/println(&quot;Content: &quot; + blueprint_spec)\n\ndef payload = JsonOutput.toJson(blueprint_spec)\nprintln(&quot;Payload: &quot; + payload)\n\ndef result = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: true, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;], [maskValue: false, name: &apos;Accept&apos;, value: &apos;application\/json&apos;]], httpMode: &apos;POST&apos;, requestBody: payload, ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@\/launch&apos;\nprintln(&quot;Status: &quot; + response.status)\nprintln(&quot;Content: &quot; + response.content)\n\ndef parseJSON(json) {\n    return new groovy.json.JsonSlurperClassic().parseText(json)\n}\n<\/script>\n    <sandbox>true<\/sandbox>\n  <\/definition>\n  <triggers\/>\n  <disabled>false<\/disabled>\n<\/flow-definition>'  | sudo su -c 'tee ~\/jobs\/@@{initial_project_name}@@_deploy\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@_deploy\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@_deploy\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@_deploy\/builds\/legacyIds' - jenkins\n\necho \"@@{Docker Registry.address}@@ @@{Docker Registry.name}@@.@@{domain_name}@@ @@{Docker Registry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Gitolite.address}@@ @@{Gitolite.name}@@.@@{domain_name}@@ @@{Gitolite.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Artifactory.address}@@ @@{Artifactory.name}@@.@@{domain_name}@@ @@{Artifactory.name}@@\" | sudo tee -a \/etc\/hosts\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a7f09fc6_runbook","main_task_local_reference":{"kind":"app_task","name":"5e34fed4_dag"},"variable_list":[]},"name":"Jenkins Master Initial Jenkins Config"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Setup SSH Jenkins User"}],"name":"2a7f764b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup SSH Jenkins User","attrs":{"exit_status":[],"script":"echo \"Create SSH Keys\"\nsudo su -c 'mkdir ~\/.ssh' - jenkins\nsudo su -c 'chmod 700 ~\/.ssh' - jenkins\nsudo su -c 'echo \"@@{Jenkins Key.secret}@@\" > ~\/.ssh\/id_rsa' - jenkins\nsudo su -c 'echo \"@@{jenkins_public_key}@@\" > ~\/.ssh\/id_rsa.pub' - jenkins\nsudo su -c 'echo \"set -o vi\" >> ~\/.bashrc' - jenkins\nsudo su -c 'echo \"StrictHostKeyChecking no\" > ~\/.ssh\/config' - jenkins\nsudo su -c 'chmod 600 ~\/.ssh\/*' - jenkins\n\necho \"\"\necho \"Get Public Key\"\necho \"jenkins_ssh_key_pub=\"$(sudo cat \/var\/lib\/jenkins\/.ssh\/id_rsa.pub)\n","eval_variables":["jenkins_ssh_key_pub"],"eval_scope":"local","script_type":"sh","type":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"824881bb_runbook","main_task_local_reference":{"kind":"app_task","name":"2a7f764b_dag"},"variable_list":[]},"name":"Jenkins Master Jenkins User Config"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Jenkins Master Jenkins User Config"},{"kind":"app_task","name":"Jenkins Master Initial Jenkins Config"},{"kind":"app_task","name":"Configure Jenkins Master"},{"kind":"app_task","name":"Jenkins Master Create Git Hook"}],"name":"1e33d0f4_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Jenkins Master Jenkins User Config"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Jenkins Master Initial Jenkins Config"}},{"from_task_reference":{"kind":"app_task","name":"Jenkins Master Initial Jenkins Config"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Jenkins Master"}},{"from_task_reference":{"kind":"app_task","name":"Configure Jenkins Master"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Jenkins Master Create Git Hook"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Master Jenkins User Config","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"824881bb_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Master Initial Jenkins Config","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"a7f09fc6_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Jenkins Master","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4709f4a9_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Master Create Git Hook","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"6f9a7f95_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"e3fc86ab_runbook","main_task_local_reference":{"kind":"app_task","name":"1e33d0f4_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2d5a6005_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a8778ba5_runbook","main_task_local_reference":{"kind":"app_task","name":"2d5a6005_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ee069ba2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"47d11a43_runbook","main_task_local_reference":{"kind":"app_task","name":"ee069ba2_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c4c94a95_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d051fa61_runbook","main_task_local_reference":{"kind":"app_task","name":"c4c94a95_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1a27c33e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9df54ae2_runbook","main_task_local_reference":{"kind":"app_task","name":"1a27c33e_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Jenkins Master"}],"name":"f813c237_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Jenkins Master","attrs":{"exit_status":[],"script":"sudo firewall-cmd --zone=public --permanent --add-port=8080\/tcp\nsudo firewall-cmd --zone=public --permanent --add-service=http\nsudo systemctl restart firewalld\nsudo yum install -y java\nsudo yum install -y wget\nsudo yum install -y git\nsudo wget -O \/etc\/yum.repos.d\/jenkins.repo http:\/\/pkg.jenkins-ci.org\/redhat\/jenkins.repo\nsudo rpm --import https:\/\/pkg.jenkins.io\/redhat\/jenkins.io.key\nsudo yum install -y jenkins\nsudo systemctl start jenkins.service\nsudo usermod -s \/bin\/bash jenkins\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4fa5acdd_runbook","main_task_local_reference":{"kind":"app_task","name":"f813c237_dag"},"variable_list":[]},"name":"Jenkins Master Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Get APP Blueprint and Profile UUID"}],"name":"44ac4cf6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get APP Blueprint and Profile UUID","attrs":{"exit_status":[],"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/list\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"POST\"\npayload = {\"filter\": \"name==@@{initial_app_deploy_blueprint}@@\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\napp_deploy_blueprint_uuid = r.json()['entities'][0]['status']['uuid']\nprint \"App Blueprint UUID: \" + app_deploy_blueprint_uuid\n\n#bp_uuid = ''\n#for entity in r.json()['entities']:\n#    if entity['status']['name'] == \"@@{initial_app_deploy_blueprint}@@\":\n#        bp_uuid = entity['status']['uuid']\n\nurl_method = 'GET'\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/\" + app_deploy_blueprint_uuid\nr = process_request(url, url_method, user, password, headers, payload)\nprint \"Response Status: \" + str(r.status_code)\nfor profile in r.json()['spec']['resources']['app_profile_list']:\n    if profile['name'] == 'Default':\n        app_profile_uuid = profile['uuid']\n       \nprint \"App Profile UUID: \" + app_profile_uuid\n\nprint \"app_deploy_blueprint_uuid=\", app_deploy_blueprint_uuid\nprint \"app_profile_uuid=\", app_profile_uuid\n","eval_variables":["app_deploy_blueprint_uuid","app_profile_uuid"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"d2950798_runbook","main_task_local_reference":{"kind":"app_task","name":"44ac4cf6_dag"},"variable_list":[]},"name":"Jenkins Master Get Blueprint Details"}],"depends_on_list":[{"kind":"app_service","name":"Artifactory"},{"kind":"app_service","name":"Docker Registry"},{"kind":"app_service","name":"Gitolite"}],"name":"Jenkins Master","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"app_deploy_blueprint_uuid","value":"","label":"","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"app_profile_uuid","value":"","label":"","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"jenkins_authorization","value":"","label":"","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"jenkins_ssh_key_pub","value":"","label":"","attrs":{"type":""},"is_hidden":false}],"description":""},{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Load Cert"}],"name":"105113e0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Load Cert","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nchmod 700 ~\/.ssh\necho \"Create SSH Keys\"\necho \"@@{Nutanix.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/*\necho \"set -o vi\" >> ~\/.bashrc\nsudo mkdir \/usr\/local\/share\/ca-certificates\/docker-dev-cert\nREGISTRY_IP=@@{Docker Registry.address}@@\nscp -i ~\/.ssh\/id_rsa -oStrictHostKeyChecking=no ${REGISTRY_IP}:~\/devdockerCA.crt \/tmp\nsudo mv \/tmp\/devdockerCA.crt \/etc\/pki\/ca-trust\/source\/anchors\/\nsudo update-ca-trust\n\nsudo service docker restart\nsleep 5\necho \"@@{Docker Registry.address}@@ @@{Docker Registry.name}@@.@@{domain_name}@@ @@{Docker Registry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Gitolite.address}@@ @@{Gitolite.name}@@.@@{domain_name}@@ @@{Gitolite.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Artifactory.address}@@ @@{Artifactory.name}@@.@@{domain_name}@@ @@{Artifactory.name}@@\" | sudo tee -a \/etc\/hosts\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"f8bc367a_runbook","main_task_local_reference":{"kind":"app_task","name":"105113e0_dag"},"variable_list":[]},"name":"Jenkins Slave Configure Connectivity"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Jenkins CLI"},{"kind":"app_task","name":"Configure Jenkins Slave"}],"name":"19e541c4_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Jenkins CLI"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Jenkins Slave"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Jenkins CLI","attrs":{"exit_status":[],"script":"#Download jenkins-cli\nsleep 30\n\nsudo wget http:\/\/@@{Jenkins Master.address}@@:8080\/jnlpJars\/jenkins-cli.jar\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Jenkins Slave","attrs":{"exit_status":[],"script":"echo \"Creating credential\"\necho '<com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey plugin=\"ssh-credentials@1.13\">\n  <scope>GLOBAL<\/scope>          \n  <id>Jenkins-Slave-Key<\/id>  \n  <description>Slave Key Based Access<\/description>\n  <username>nutanix<\/username>\n  <privateKeySource class=\"com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey$DirectEntryPrivateKeySource\">\n      <privateKey>@@{Nutanix.secret}@@ <\/privateKey>\n  <\/privateKeySource>\n<\/com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey>' | sudo java -jar \/home\/@@{Nutanix.username}@@\/jenkins-cli.jar -auth admin:@@{Jenkins Master.jenkins_authorization}@@ -s http:\/\/@@{Jenkins Master.address}@@:8080  create-credentials-by-xml system::system::jenkins _ \n\necho \"Creating slave node\"\ncat <<EOF | sudo java -jar \/home\/@@{Nutanix.username}@@\/jenkins-cli.jar -auth admin:@@{Jenkins Master.jenkins_authorization}@@ -s http:\/\/@@{Jenkins Master.address}@@:8080 create-node @@{name}@@\n<slave>\n  <name>@@{name}@@<\/name>\n  <description>Jenkins Slave Node<\/description>\n  <remoteFS>\/home\/nutanix<\/remoteFS>\n  <numExecutors>1<\/numExecutors>\n  <mode>NORMAL<\/mode>\n  <launcher class=\"hudson.plugins.sshslaves.SSHLauncher\" plugin=\"ssh-slaves\">\n    <host>@@{address}@@<\/host>\n    <port>22<\/port>\n    <credentialsId>Jenkins-Slave-Key<\/credentialsId>\n    <maxNumRetries>0<\/maxNumRetries>\n    <retryWaitTime>0<\/retryWaitTime>\n    <sshHostKeyVerificationStrategy class=\"hudson.plugins.sshslaves.verifiers.NonVerifyingKeyVerificationStrategy\"\/>\n  <\/launcher>\n  <label>build<\/label>\n  <nodeProperties\/>\n<\/slave>\nEOF","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6d2cd303_runbook","main_task_local_reference":{"kind":"app_task","name":"19e541c4_dag"},"variable_list":[]},"name":"Configure Jenkins Slave"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Jenkins Slave Configure Connectivity"},{"kind":"app_task","name":"Configure Jenkins Slave"}],"name":"ae5e6af0_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Jenkins Slave Configure Connectivity"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Jenkins Slave"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Slave Configure Connectivity","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"f8bc367a_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Jenkins Slave","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"6d2cd303_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"af3d1fe3_runbook","main_task_local_reference":{"kind":"app_task","name":"ae5e6af0_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e92443c7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"555be4c9_runbook","main_task_local_reference":{"kind":"app_task","name":"e92443c7_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"00c19b6d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"04de4a48_runbook","main_task_local_reference":{"kind":"app_task","name":"00c19b6d_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"117602e2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ccc2a1d7_runbook","main_task_local_reference":{"kind":"app_task","name":"117602e2_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6e79884f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d6f485c8_runbook","main_task_local_reference":{"kind":"app_task","name":"6e79884f_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Docker"},{"kind":"app_task","name":"Install Docker Compose"}],"name":"8f42cde8_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker Compose"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker","attrs":{"exit_status":[],"script":"echo \"** Install Required Packages...\"\nsudo yum install -y yum-utils\nsudo yum install -y epel-release.noarch\nsudo yum install -y httpd-tools\n\necho \"** Adding Docker Repo...\"\nsudo yum-config-manager --add-repo=https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\n\necho \"** Set apt-cache policy for docker-ce...\"\nsudo yum-config-manager --enable docker-ce-nightly\n\necho \"** Installing Docker CE...\"\nsudo yum install -y docker-ce\nsudo yum makecache fast\n\necho \"** Adding current user to docker group...\"\nsudo usermod -aG docker @@{Nutanix.username}@@\n\necho \"** Starting Docker CE...\"\nsudo service docker start\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker Compose","attrs":{"exit_status":[],"script":"echo \"** Installing python-pip...\"\nsudo yum install -y python-pip\n\necho \"** Upgrade pip...\"\nsudo pip install --upgrade pip\n\necho \"** Install docker-compose...\"\nsudo curl -L \"https:\/\/github.com\/docker\/compose\/releases\/download\/1.24.1\/docker-compose-$(uname -s)-$(uname -m)\" -o \/usr\/local\/bin\/docker-compose\nsudo chmod +x \/usr\/local\/bin\/docker-compose\nsudo ln -s \/usr\/local\/bin\/docker-compose \/usr\/bin\/docker-compose\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"eb6bcfac_runbook","main_task_local_reference":{"kind":"app_task","name":"8f42cde8_dag"},"variable_list":[]},"name":"Jenkins Slave Docker Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Required Packages"}],"name":"20cf7e99_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Required Packages","attrs":{"exit_status":[],"script":"sudo yum install -y java\nsudo yum install -y wget\nsudo yum install -y git\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"c8435ece_runbook","main_task_local_reference":{"kind":"app_task","name":"20cf7e99_dag"},"variable_list":[]},"name":"Jenkins Slave Java Installation"}],"depends_on_list":[{"kind":"app_service","name":"Jenkins Master"}],"name":"Jenkins Slave","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"K8s and Docker Integrations"}],"name":"7e6e6343_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"K8s and Docker Integrations","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"bd833f80_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"3740c866_runbook","main_task_local_reference":{"kind":"app_task","name":"7e6e6343_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e52020ce_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f21f04f9_runbook","main_task_local_reference":{"kind":"app_task","name":"e52020ce_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Output Connection Details"}],"name":"dec987ed_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Output Connection Details","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"86d8bab2_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"55859ca7_runbook","main_task_local_reference":{"kind":"app_task","name":"dec987ed_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4be63bc9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4f4ad2e5_runbook","main_task_local_reference":{"kind":"app_task","name":"4be63bc9_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cb3a64c3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8a3059a2_runbook","main_task_local_reference":{"kind":"app_task","name":"cb3a64c3_dag"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create and Push Docker Images"},{"kind":"app_task","name":"K8s Credential Creation"}],"name":"f2b4f45c_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Create and Push Docker Images"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"K8s Credential Creation"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create and Push Docker Images","attrs":{"exit_status":[],"script":"export DOCKER_REGISTRY=@@{Docker Registry.name}@@.@@{domain_name}@@\nexport PROJECT_NAME=@@{initial_project_name}@@\necho \"Login into Docker Registry\"\ndocker login -u @@{Docker Registry Credential.username}@@ -p @@{Docker Registry Credential.secret}@@ $DOCKER_REGISTRY\ncd ~\/@@{initial_project_name}@@\n\necho \"Build and Push Ansible Image\"\ndocker build -t ${DOCKER_REGISTRY}\/@@{initial_project_name}@@\/ansible docker-ansible\/src\ndocker push ${DOCKER_REGISTRY}\/@@{initial_project_name}@@\/ansible\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"K8s Credential Creation","attrs":{"exit_status":[],"script":"echo \"Get KUBECONFIG\"\nscp -i ~\/.ssh\/id_rsa -oStrictHostKeyChecking=no @@{Docker Registry Credential.username}@@@@@{Docker Registry.address}@@:~\/kubeconfig.yml .\n\nexport KUBECONFIG=kubeconfig.yml\n\necho \"Check creds...\"\nkubectl get secrets -n @@{yourname}@@\n\necho \"Create docker-registry-cred\"\nkubectl create secret generic docker-registry-cred-@@{Docker Registry.app_name}@@ --from-file=.dockerconfigjson=.docker\/config.json --type=kubernetes.io\/dockerconfigjson -n @@{yourname}@@\n\n#rm kubeconfig.yml","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"bd833f80_runbook","main_task_local_reference":{"kind":"app_task","name":"f2b4f45c_dag"},"variable_list":[]},"name":"K8s and Docker Integrations"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Jenkins Master Details"},{"kind":"app_task","name":"Docker Repository Details"},{"kind":"app_task","name":"Artifactory Details"},{"kind":"app_task","name":"Developer Workstation Details"}],"name":"dda461cf_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Jenkins Master Details"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Docker Repository Details"}},{"from_task_reference":{"kind":"app_task","name":"Docker Repository Details"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Artifactory Details"}},{"from_task_reference":{"kind":"app_task","name":"Artifactory Details"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Developer Workstation Details"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Master Details","attrs":{"script":"print \"-------------------------\"\nprint \"\"\nprint \"Jenkins Master Host Name:\"\nprint \"@@{Jenkins Master.name}@@\"\nprint \"\"\nprint \"Jenkins Master IP Address:\"\nprint \"@@{Jenkins Master.address}@@\"\nprint \"\"\nprint \"Initial Authorization Password:\"\nprint \"@@{Jenkins Master.jenkins_authorization}@@\"\nprint \"\"\nprint \"Jenkins Master URL:\"\nprint \"http:\/\/@@{Jenkins Master.address}@@:8080\/\"\nprint \"\"\nprint \"-------------------------\"","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Docker Repository Details","attrs":{"script":"print \"-------------------------\"\nprint \"\"\nprint \"Docker Registry Host Name:\"\nprint \"@@{Docker Registry.name}@@\"\nprint \"\"\nprint \"Docker Registry IP Address:\"\nprint \"@@{Docker Registry.address}@@\"\nprint \"\"\nprint \"Docker Registry URLs:\"\nprint \"View Repostitories:\"\nprint \"https:\/\/@@{Docker Registry.address}@@\/v2\/_catalog\"\nprint \"\"\nprint \"View Tags:\"\nprint \"https:\/\/@@{Docker Registry.address}@@\/v2\/<repository>\/tags\/list\"\nprint \"\"\nprint \"For Example\"\nprint \"https:\/\/@@{Docker Registry.address}@@\/v2\/nutanix\/ansible\/tags\/list\"\nprint \"\"\nprint \"-------------------------\"","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Artifactory Details","attrs":{"script":"print \"-------------------------\"\nprint \"\"\nprint \"Artifactory Host Name:\"\nprint \"@@{Artifactory.name}@@\"\nprint \"\"\nprint \"Artifactory IP Address:\"\nprint \"@@{Artifactory.address}@@\"\nprint \"\"\nprint \"Username:\"\nprint \"admin\"\nprint \"\"\nprint \"Password:\"\nprint \"password\"\nprint \"\"\nprint \"Artifactory URL:\"\nprint \"http:\/\/@@{Artifactory.address}@@:8081\/artifactory\/webapp\"\nprint \"\"\nprint \"-------------------------\"","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OneTimeWorkFlows"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Developer Workstation Details","attrs":{"script":"print \"-------------------------\"\nprint \"\"\nprint \"Developer Workstaion Host Name:\"\nprint \"@@{Developer Workstation.name}@@\"\nprint \"\"\nprint \"Developer Workstaion IP Address:\"\nprint \"@@{Developer Workstation.address}@@\"\nprint \"\"\nprint \"-------------------------\"","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"86d8bab2_runbook","main_task_local_reference":{"kind":"app_task","name":"dda461cf_dag"},"variable_list":[]},"name":"Output Connection Details"}],"depends_on_list":[{"kind":"app_service","name":"Developer Workstation"}],"name":"OneTimeWorkFlows","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"ArtifactoryVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"15","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"artifactory-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"dd1a9fed-a931-48d4-9861-4ac102da2480"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\nssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"53fe143f-b2e8-4435-a54a-a7269f73e1fc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"d10ab93c-02cf-4481-a0af-1869eb76afac"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"DockerRegistryVM"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Lowercase App Name"}],"name":"eacf5b50_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_substrate","name":"DockerRegistryVM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Set Lowercase App Name","attrs":{"exit_status":[],"script":"print \"app_name=\" + \"@@{calm_application_name}@@\".lower().replace(\" \",\"\")","eval_variables":["app_name"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"c3fe6d3c_runbook","main_task_local_reference":{"kind":"app_task","name":"eacf5b50_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"DockerRegistryVM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0e81a312_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8b545e17_runbook","main_task_local_reference":{"kind":"app_task","name":"0e81a312_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"DockerRegistryVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"15","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"docker-registry-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"dd1a9fed-a931-48d4-9861-4ac102da2480"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\nssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: docker-registry"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"53fe143f-b2e8-4435-a54a-a7269f73e1fc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"d10ab93c-02cf-4481-a0af-1869eb76afac"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"GitoliteVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"15","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"git-server-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"dd1a9fed-a931-48d4-9861-4ac102da2480"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\nssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"53fe143f-b2e8-4435-a54a-a7269f73e1fc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"d10ab93c-02cf-4481-a0af-1869eb76afac"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"JenkinsMasterVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"15","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"jenkins-master-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"dd1a9fed-a931-48d4-9861-4ac102da2480"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\nssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"53fe143f-b2e8-4435-a54a-a7269f73e1fc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"d10ab93c-02cf-4481-a0af-1869eb76afac"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"JenkinsSlaveVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"15","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"jenkins-slave-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"dd1a9fed-a931-48d4-9861-4ac102da2480"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\nssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"53fe143f-b2e8-4435-a54a-a7269f73e1fc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"d10ab93c-02cf-4481-a0af-1869eb76afac"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"WorkstationVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"15","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"dev-workstation-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"dd1a9fed-a931-48d4-9861-4ac102da2480"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\n#ssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"53fe143f-b2e8-4435-a54a-a7269f73e1fc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"d10ab93c-02cf-4481-a0af-1869eb76afac"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"EXISTING_VM","name":"K8sWorkflows","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{ip_address}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"os_type":"Linux","create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"@@{WorkstationVM.address}@@"},"variable_list":[]}],"credential_definition_list":[{"username":"nutanix","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"TO1VZSTO5cliXb6\/IBTpHifwP3GH5RPbMGe501Qqi7gEUv1hVoLmFEOh:utf-8"},"name":"Docker Registry Credential"},{"username":"sho.uchida@apjsme.com","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"L3ld8EmGiTTo\/zWw3xRg9Z7HtKX2LK+kjSV4+jWWV9wl99ymUOteow==:utf-8"},"name":"Prism Central User","editables":{"username":true,"secret":true}},{"username":"jenkins","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"liuLVlGbXgv9xBupC\/gxak0QsKPcVxYdZO6pnnXrywyqi9NBUDrGzsdDuosFjc4AFhwNnmAsDsje7hk1rsdfLZiD1tiVr\/r0vUWdvCqgcBIw6bdEbqcw5jGmruztv\/Y1dDcFATGpRJAzyphbs0BCeB1vV\/lDuLAX2LM0nCDq0K3VxW1+1IHmvhJuJNoy0dPuPcO6VYpSMhg0YEfDYQiTBHjZUX7Hh7b8Qa\/bf54a0\/Amoyl8fm9YZ+0OtVggFhBerUXy5Dj8dKjHRFInxpzx6s+vx5RR+TqUfY\/2Q1Mnr1pJ4F2ymyuiBus6HBz7v2aWjeTsRdSTU4O9EhyR1Dp6dCvJxWL4xnJ5IOrMd37VdGCOaw5bvYndyBI1AA6jrOkvdQV8m60VbJGmqNja\/NStcSVBZcnVwEYB2P7nZnK6awe9oiBWaBYTa5izAq1xMWWpECuKHMSglMmIPOemYeJVHOmvOsDTdPgVqLLJoUWZSvP\/pJ83wZwEI6FoOykFypAsGUKaqHHpGXKhrs\/bN8MV3FjmvRu3djffCXkcUApvZhPFwf7WezU3KycyEsoDTA6H9OoZZFpJYtU7hAmJHglCHG4tJsDp30EGhItVBmWCCkDSgPZtnZjKZSF051KStmaxEdp17iKQaXzNnsic89ywdw4mvvhizvhdFVSvqnnGJf6V9kmuFJfvkGWHJmqbATn9dEZFEHF5r924LHTid\/DC3NZHRhB67WoXzwexbgO23Bc2XaekHVSqunqjNRyNwCS0Z5kTBhmXj04ANoWsYOhKQJf8CpEMXjTxdGP+u9XCtszxxYZGVFZ4jLmxSw1ffzhJeeKJ51667SXJf2VnfZ7dE9po6SaJYoExO\/DOqWtjVCZV9yKsqtYPsggA7Jbht+9fiuwTZgpQq5scEmaGASiWkCOLmfUO9TRzDM+Ay8fPCFnorJ6WEzqR6OyCnFV6Mvf7x2HFi+8qJGzFkgZcQ6XUUwev5243ey5I7gk0EhoR1tw3+UIZYyoI5CddEMNJbyjGi8id9RAlnu+FG2XvsgZ1t8JBPJjWlUPlAeDxKIeF9RrwUCUoiNLY+wHnm6TumZSqcM6qvwpbLjER3VP1zDUVmLY+ONw0cAsgLBW1G6LoxN\/VfzE1m+cGfjMxzw7C+sDwS2jp0xcTXDS1lbdaY\/Sftf8vbqPtSUFdIGmwqbqDHjfkjpQv95NmRCdqCbDQtWd+KHEoGYsivCXqnNKZj77R919VixyU5zENtHdgB29CgnbznWbC4+zsLB4vS2gtc8SH9X4u3nqg7x1bVXl6g5zu79PzVvta9OH5i183lyp3SlFvposkZhAjr\/qOzFcd0IgcqGn+jRNXjveG\/2Pa5XfrlKiBtqi1F4lY8T0IxOkjdEUsdcen\/dSCyrDID+8jScmTx8cgwAsJK8dw1O3EDqpeEPFhX4e+d7RU2umEh6REkak08CN+MC3gKHEIKuxJ+nBeCmDwGOebT7ILWWrCluhUBAYSvkVUJxOkTknOybcbhe97z049yBaG\/yQLLcawDeqEzjgY2c8rA7UrI65GnpTUD1C6raLQbAKIFaneh21tIGZwI0vPKe3OmuTCMKkk4kTA\/wAUSBZQTwBdd3ypO+JbhcjAaHDgS5\/NMnWv11jPAcyIIPdLtfpAUjvppQHxRutirSXiLy5BeJNVvgzFLExwuJuxHYaUTUyLsS0nKad6QQsh1Sz74OZw7aYgxTYjp9b3qOYHTJkjGzdbQ6rB86oW8\/4DLAFJm8dyIpdZflLoYuv+q5noSOT8qQPaiBFGO6Rnpdh59ex99Ttgnef8kzbvNP6mp8gWFqvTMetc9UCmNztjTAGWXl8Xo\/TSqg2C1wjTQKozUhhF5MVTJnA3\/zCgpU4xGfbpJVF1LcJUzCSEO8Hv\/6Qp7XYCnm1UdrKo9NynZj9WYvTLOrjGf3fd4LWNRiMgfBv9nvVq5Yd5R37LcicHAdqwxJV1YkQM1QU75GRrFOrjZeCINUyifxvEVMHWns9XoQ9ZAEDPRBLyWKiXQn2jXwKuKsSR\/qlk0ITS3d8s6EPPBqwjXlNZIIDcFpIlftQNA2pbuXRdyaub+J\/ihXMvitxYnsi5zuSSNT3FcHK1aKuynIO\/s7mMa7Ne8a5rODUu7SiLXnGECWxK9UjKCldl1UFOzs4RsbEpAyCsAbvUqkJiRUqUd6XCC67CeQk2bU7pF4bhYa1Q729yQZNCMYFRuKme1Zdijhh1LgL+8xjkuS0nDievO6uWJL1aEDXS8yPPF8TdhZWGroiWl+Ec5\/hvnYUYMv8zcBG5qnHCq4eQ\/UmKf0S560pY0eet5fLW8xOfXu+2NwKEQcY9SdZlQB7CJgVqWugs5Hnt5r4pT3nEStn642lQmEIl7iuJ56HoYypx\/sykcmzDJo1x70GeI+YcieNOmc0PB1F9tWxGGpFBDEE0mCaoJtmwSY+zNOcBKTp5OBdhDb1\/IC7B\/Vif:utf-8"},"name":"Jenkins Key"},{"username":"nutanix","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"GEcm7SC67Q1gWt8B0G1klusWTOtjtHsJEtaRlPhJs+ifarVn\/SnIswrTE\/XHuXpHd59X1KZjgDPJyUXw4nHb2Z22+R39YurUCHeKVc8wKYa37A3QTm+rdemmaA6Kevi5qJH8NnWE1u2Mb3hkmILMyQvY8UQXAdS0wSQnXOPnOFDlC6Q5XTg4OVxmqKvUCXmXp68s04cTD7Qr+nL6KFv1M3fwwxXxkzN4O6Fv\/d6UAVJMOiVVjLqfcABEjtt4gGPBpuZDvBSx3U2JzTVC+AmnTw3u9O0jL1FdwkTChPGcHwIEOGfkm\/qvAVaM7xpVi2C\/iywFQJmbAlQKHhvarMGUubPZqFH91B7m23VCPhxxtHpPi2jtVZTuVmgAoDDX+QgHBGyNw2DYzAbcEZDXqplLvR7H3kUomGtJz2+QEZ7zF207b0smn4jai1oF1IcePyNzZvmHwP\/XEv+0AIbEJ\/m8Exk2NDdhJR9xC8VjndygbMwun7MUrPOBDenjwK9Dzvmjuh7DNa\/zILtERR4aim4aqFVU2938yCjopkMSuj7Kgtn9MqOOuJe+qWN9VMzD4XSaBvJqUcZQjFPZ2\/unApZCip6OfpkKK4boCC75TssTYHWxpYBVnQfLBVESDCetS7jV3t86U2g8h2fyObZ9vEYnwfTnq2RLOBRBoC07iyYluBl8jwjioQmRVDM+JIOyj1+vzy3+O9A7Gb540i2gcr4RZRizCnV2u9\/m8Bf9hPneKlSuYy7uxIIz2rJx2N+gX3Cm+22RhOIiB1LjMjp1bh9FPYMuw35XeO\/+KXTwrhz782296oieThhyjCQgin2fnzgK02tdMi6Jdh4qxnwb5Ec0QFOWyvG0\/b+ivEoPd94ZenOooeYORglD6JEKExGuxIW+4Lq7NTsSOQI20d5S88cTGc\/hw0qM4pUH9GNTzguxyRiwS2NFELAf+i4yMycMbDdWG2M5yfj7KV7fo8vdXOGPb+w04kO1u5HlLArc87t+xLyPqWVr2xxwPT5656+Mzs4zKiVrLP948blBFAmqXjgD2AA\/sll8ZmHC7VNcyvuwEtsfeOf4m24IyQLA1zC6gE+h5OCY3BaYEMQaBh8zKb7h6POGL8L9o0apOVMyEN8Q7hho8SZR1uhsmpdkXs8i1Uwy9Qfw1A5u9KG2JizQtPZDAWpIpIleOZRUdV32wHIRvHUeAhNUi5xxXVGBoMNKbLhzh49ucXNfVbDkII7Dz6BNNHyCZinjiSpfUNR\/8tTWvcn+U\/g7Mh\/O0UKlRQMHmttInrnfNjmUX8Iss64s+iGIeZxtG+mTRgpWp6DOda+RcI7x6oeu+GhckprvoL85uTXAbr2bdO7pngneCcqgJar3x\/wPIHc8wCyxxcag2pqr2qPzgFbjS+gk8XDOag2GWbiqebGmBOsdBmb2UPzEbnod37VfO\/ozWN70CttcrX9W8x3fYjvcfYZRkfjkb8\/JUjaAiQfEt8pxuWKd3zfgJJ03qafB3XPrsNXp+YfFKBTsi\/\/s+xTL1ik9qMmR9vpBowpbxKPT+2LVIPiXg4mcapdVCOsZ836kXNfpEnGx5IRVyhfN9g9OE+0dP92CjG2AAAMypYrv9D\/RZlgSZaoxZO9wplFljQ\/deLM3bW7ckU+0zV9JS8RGuzsqAeRu3Ili3Q3J66zkOwW7VN6s5fiDDQ28yQ+CVRgpEsInNYZVunFenC\/jwH5FUeA6eg0oUTTmQdJU1hwM6y4ulnTTX0i9+i7ugYErE9j2enO4S2GAF0j9pSrcYtU6krzQQybGO\/857yx\/LXAunI6UrsPxfKtTSokZ78ObiyznybtRgIvvpbfJe1IcGTA1wXdks1oRwqXv9lCK2ULbC9op0szlDoencM0lPR9khajBZLlTBozR3P\/sFflR5fBwwmh93IHNdjSmapakAAe+Afx4ddQaLerIkaEyU3l4aulQv5Hov8E3Y5HHqODIBzJ\/pBAhq2TlI4BLyhT8u5nr\/MNdFXOeHZW5S+aO\/v\/KTMGr38bNLXH\/D1a9X3NYJBlwZKMe8tuSNWNokpeBP2na0+rrCsZHhCKkKp4Ub\/wui3HcvFinCIHFfX7r43riy6UHopLZALHKT6RziXTp\/L1Py7UjIEqUqt41rInghxHj99\/JqRh1a9+LcfAAM6BPdncPHPPhkiEJt15G7eVf2PkY69h3CLy51TowIXpuDiatDKJR5ME58518Rl1IpGKZ423u7HAfM3knylK\/YBuVJ1gFXq57W204uJQG+0Z4oK6+dDsFttc+F6RDFDVm8O16S\/eClUdxZfPlu9teNxjYIrhVciNMlR+b4XjFIxn1l\/Fg44UnOqpMWuzc+N7wNy2GjLLvHqxDT5UUMipUN3L9ZKX7xiQpEJ11yq84uJmxQ8NG3kY0U1Htxv66Xy72bO9f0hBmoJxNjuM6Q+Yn7YH\/hdqSiVoqmcYFFo6z3Uj8YULyKDELWzDGFqykx\/he:utf-8"},"name":"Nutanix"},{"username":"nutanix","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"RlEaXo99IPUpKKfSK3bng41F5eYpQye4T82Ut99YjHXbbrwFQj0UH8vx:utf-8"},"name":"Karbon Node"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Artifactory"}],"name":"ArtifactoryPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ArtifactoryPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Artifactory Docker Installation"},{"kind":"app_task","name":"Artifactory Installation"}],"name":"8e7d1b8d_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Artifactory Docker Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Artifactory Installation"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Artifactory Docker Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"350f897b_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Artifactory Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"af31aac3_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"71d086d7_runbook_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8e7d1b8d_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ArtifactoryPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"ae0fc3d0_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"3867060f_runbook_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"ae0fc3d0_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Docker Registry"}],"name":"Docker Registry Install","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Docker Registry Install"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Registry Docker Installation"},{"kind":"app_task","name":"Docker Registry Installation"},{"kind":"app_task","name":"Docker Registry Add Certs to Karbon"}],"name":"57ea840c_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Registry Docker Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Docker Registry Installation"}},{"from_task_reference":{"kind":"app_task","name":"Docker Registry Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Docker Registry Add Certs to Karbon"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Docker Registry Docker Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"991aa9e9_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Docker Registry Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"6a6ef171_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Docker Registry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Docker Registry Add Certs to Karbon","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"6863c6ee_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"6423da3d_runbook_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"57ea840c_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Docker Registry Install"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"e4a1d78d_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2b6f43e2_runbook_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"e4a1d78d_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Gitolite"}],"name":"GitolitePackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GitolitePackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Gitolite Installation"}],"name":"037bb3fc_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Gitolite Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"a89a99a1_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"30a62397_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"037bb3fc_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GitolitePackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"29d1a79f_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e129694b_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"29d1a79f_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Jenkins Master"}],"name":"JenkinsMasterPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"JenkinsMasterPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Jenkins Master Installation"},{"kind":"app_task","name":"Jenkins Master Configure Base User"},{"kind":"app_task","name":"Jenkins Master Get Blueprint Details"}],"name":"116239e7_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Jenkins Master Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Jenkins Master Configure Base User"}},{"from_task_reference":{"kind":"app_task","name":"Jenkins Master Configure Base User"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Jenkins Master Get Blueprint Details"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Jenkins Master Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4fa5acdd_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Jenkins Master Configure Base User","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"7ea304d1_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Jenkins Master Get Blueprint Details","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"d2950798_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"debd6783_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"116239e7_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"JenkinsMasterPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"75071e5e_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"784076f4_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"75071e5e_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Jenkins Slave"}],"name":"JenkinsSlave Install","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"JenkinsSlave Install"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Jenkins Slave Docker Installation"},{"kind":"app_task","name":"Jenkins Slave Java Installation"}],"name":"57ea840c_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Jenkins Slave Docker Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Jenkins Slave Java Installation"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Jenkins Slave Docker Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"eb6bcfac_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Jenkins Slave Java Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"c8435ece_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"6423da3d_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"57ea840c_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"JenkinsSlave Install"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"e4a1d78d_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2b6f43e2_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"e4a1d78d_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Developer Workstation"}],"name":"WorkstationPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WorkstationPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Developer Workstation Docker Installation"},{"kind":"app_task","name":"Developer Workstation NodeJS Installation"},{"kind":"app_task","name":"Developer Workstation Kubectl Installation"}],"name":"8e7d1b8d_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Developer Workstation Docker Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Developer Workstation NodeJS Installation"}},{"from_task_reference":{"kind":"app_task","name":"Developer Workstation NodeJS Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Developer Workstation Kubectl Installation"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Developer Workstation Docker Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4d4b18fe_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Developer Workstation NodeJS Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"ffab2e14_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Developer Workstation Kubectl Installation","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"ce76be5f_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"71d086d7_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8e7d1b8d_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WorkstationPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Developer Workstation K8s Clean Up"}],"name":"ae0fc3d0_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Developer Workstation K8s Clean Up","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"60fc2582_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"3867060f_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"ae0fc3d0_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"OneTimeWorkFlows"}],"name":"Package7","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package7"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"92bb4416_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"fa3c5af8_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"92bb4416_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package7"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"f8adc792_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"72c8a31c_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"f8adc792_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"centos7_generic","version":"","options":{"type":"","name":"CENTOS-7.4","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"1afa7711_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"JenkinsMasterPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"JenkinsMasterVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"8cafc62e_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"5","package_local_reference_list":[{"kind":"app_package","name":"JenkinsSlave Install"}],"substrate_local_reference":{"kind":"app_substrate","name":"JenkinsSlaveVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"8cafc62e_deployment_cloned_1","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Docker Registry Install"}],"substrate_local_reference":{"kind":"app_substrate","name":"DockerRegistryVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"aa65c031_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"10","package_local_reference_list":[{"kind":"app_package","name":"WorkstationPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"WorkstationVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"aa65c031_deployment_cloned_1","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"ArtifactoryPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"ArtifactoryVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"fe95f237_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"GitolitePackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"GitoliteVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"a0b9926e_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package7"}],"substrate_local_reference":{"kind":"app_substrate","name":"K8sWorkflows"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"Scales down the number of Developer workstations deployed by one.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Task1"}],"name":"52bb136c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"aa65c031_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Task1","attrs":{"scaling_count":"2","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"ab270777_runbook","main_task_local_reference":{"kind":"app_task","name":"52bb136c_dag"},"variable_list":[]},"name":"Scale Down Dev Workstation"},{"description":"Scales down the number of Jenkins slaves deployed by one.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Down"}],"name":"d7562e3b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"8cafc62e_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale Down","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"31c4de29_runbook","main_task_local_reference":{"kind":"app_task","name":"d7562e3b_dag"},"variable_list":[]},"name":"Scale Down Jenkins Slave"},{"description":"Scales up the number of Developer workstations deployed by one.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale UP"}],"name":"b536d0d0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"aa65c031_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale UP","attrs":{"scaling_count":"2","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"f3252490_runbook","main_task_local_reference":{"kind":"app_task","name":"b536d0d0_dag"},"variable_list":[]},"name":"Scale Up Dev Workstation"},{"description":"Scales up the number of Jenkins slaves deployed by one.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Up"}],"name":"ae22a5e6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"8cafc62e_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale Up","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"3801c5df_runbook","main_task_local_reference":{"kind":"app_task","name":"ae22a5e6_dag"},"variable_list":[]},"name":"Scale Up Jenkins Slave"},{"description":"Create a new Jenkins pipeline with corresponding Git repository. This include configuring the connectivity required to kick off the Jenkins pipeline job from a code commit to the Git repository. The demo code is also downloaded and staged on any Developer workstations that have been deployed.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Artifact Repository"},{"kind":"app_task","name":"Initialize Git Repository"},{"kind":"app_task","name":"Get APP Blueprint and Profile UUID"},{"kind":"app_task","name":"Configure Project Access"},{"kind":"app_task","name":"Config Jenkins Jobs"},{"kind":"app_task","name":"Initialize Workstation Git Repository"},{"kind":"app_task","name":"Restart Jenkins Service"},{"kind":"app_task","name":"Download Version 1 Demo Code"},{"kind":"app_task","name":"Wait for Restart"},{"kind":"app_task","name":"Create Git Hook"},{"kind":"app_task","name":"Create and Push Docker Images"}],"name":"efbcbb73_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Initialize Workstation Git Repository"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Download Version 1 Demo Code"}},{"from_task_reference":{"kind":"app_task","name":"Initialize Git Repository"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Project Access"}},{"from_task_reference":{"kind":"app_task","name":"Configure Project Access"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Initialize Workstation Git Repository"}},{"from_task_reference":{"kind":"app_task","name":"Get APP Blueprint and Profile UUID"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Config Jenkins Jobs"}},{"from_task_reference":{"kind":"app_task","name":"Config Jenkins Jobs"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart Jenkins Service"}},{"from_task_reference":{"kind":"app_task","name":"Restart Jenkins Service"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Wait for Restart"}},{"from_task_reference":{"kind":"app_task","name":"Wait for Restart"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Git Hook"}},{"from_task_reference":{"kind":"app_task","name":"Configure Project Access"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Git Hook"}},{"from_task_reference":{"kind":"app_task","name":"Download Version 1 Demo Code"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create and Push Docker Images"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Artifact Repository","attrs":{"exit_status":[],"script":"echo \"Initialize Artifactory @@{new_project_name}@@ Repository\"\n\necho '  @@{new_project_name}@@-local-repo:\n    type: generic\n    checksumPolicyType: server-generated-checksums\n    description: \"@@{new_project_name}@@ Artifact Repository\"\n    dockerApiVersion: V2\n    excludesPattern:\n    includesPattern:\n    maxUniqueSnapshots: 0\n    maxUniqueTags: 0\n    repoLayout: simple-default\n    snapshotVersionBehavior: unique\n    blackedOut: false\n    enableFileListsIndexing: false\n    forceNugetAuthentication: false\n    handleReleases: true\n    handleSnapshots: true\n    suppressPomConsistencyChecks: true' >> ~\/artifactory-repo-config.yml\n\nsleep 3\n\ncurl -u admin:password -X PATCH \"http:\/\/localhost:8081\/artifactory\/api\/system\/configuration\" -H \u201cContent-Type:application\/yaml\u201d -T ~\/artifactory-repo-config.yml\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initialize Git Repository","attrs":{"exit_status":[],"script":"echo \"Create and Configure @@{new_project_name}@@ Repository\"\nsudo su -c 'mkdir ~\/repositories\/@@{new_project_name}@@.git' - git\nsudo su -c 'cd ~\/repositories\/@@{new_project_name}@@.git && git init --bare' - git\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get APP Blueprint and Profile UUID","attrs":{"exit_status":[],"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/list\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"POST\"\npayload = {\"filter\": \"name==@@{new_app_deploy_blueprint}@@\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\napp_deploy_blueprint_uuid = r.json()['entities'][0]['status']['uuid']\nprint \"App Blueprint UUID: \" + app_deploy_blueprint_uuid\n\n#bp_uuid = ''\n#for entity in r.json()['entities']:\n#    if entity['status']['name'] == \"@@{new_app_deploy_blueprint}@@\":\n#        bp_uuid = entity['status']['uuid']\n\nurl_method = 'GET'\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/\" + app_deploy_blueprint_uuid\nr = process_request(url, url_method, user, password, headers, payload)\nprint \"Response Status: \" + str(r.status_code)\nfor profile in r.json()['spec']['resources']['app_profile_list']:\n    if profile['name'] == 'Default':\n        app_profile_uuid = profile['uuid']\n       \nprint \"App Profile UUID: \" + app_profile_uuid\n\nprint \"app_deploy_blueprint_uuid=\", app_deploy_blueprint_uuid\nprint \"app_profile_uuid=\", app_profile_uuid\n","eval_variables":["app_deploy_blueprint_uuid","app_profile_uuid"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Project Access","attrs":{"exit_status":[],"script":"echo \"Configure @@{new_project_name}@@ Repository Access\"\necho \"repo @@{new_project_name}@@\" >> ~\/gitolite-admin\/conf\/gitolite.conf\necho \"    RW+     =   @all\" >> ~\/gitolite-admin\/conf\/gitolite.conf \necho \"    R       =   jenkins\" >> ~\/gitolite-admin\/conf\/gitolite.conf \n\necho \"Check IN and Commit Changes\"\ncd gitolite-admin\ngit add conf\/gitolite.conf\ngit commit -m \"Added @@{new_project_name}@@ Repository\"\ngit push origin master","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Config Jenkins Jobs","attrs":{"exit_status":[],"script":"echo 'Create @@{new_project_name}@@ Pipeline'\nsudo usermod -s \/bin\/bash jenkins\nsudo su -c 'mkdir -p ~\/jobs\/@@{new_project_name}@@\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/@@{new_project_name}@@\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/@@{new_project_name}@@\/nextBuildNumber' - jenkins\n\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY_USER<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry Credential.username}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.PasswordParameterDefinition>\n          <name>DOCKER_REGISTRY_PASSWORD<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry Credential.secret}@@<\/defaultValue>\n        <\/hudson.model.PasswordParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry.name}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue>@@{new_project_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>ARTIFACTORY_INSTANCE<\/name>\n          <description><\/description>\n          <defaultValue>@@{Artifactory.name}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <scm class=\"hudson.plugins.git.GitSCM\" plugin=\"git@3.9.1\">\n      <configVersion>2<\/configVersion>\n      <userRemoteConfigs>\n        <hudson.plugins.git.UserRemoteConfig>\n          <url>git@@@{Gitolite.name}@@.@@{domain_name}@@:@@{new_project_name}@@.git<\/url>\n          <credentialsId>Jenkins<\/credentialsId>\n        <\/hudson.plugins.git.UserRemoteConfig>\n      <\/userRemoteConfigs>\n      <branches>\n        <hudson.plugins.git.BranchSpec>\n          <name>*\/master<\/name>\n        <\/hudson.plugins.git.BranchSpec>\n      <\/branches>\n      <doGenerateSubmoduleConfigurations>false<\/doGenerateSubmoduleConfigurations>\n      <submoduleCfg class=\"list\"\/>\n      <extensions\/>\n    <\/scm>\n    <scriptPath>Jenkinsfile<\/scriptPath>\n    <lightweight>true<\/lightweight>\n  <\/definition>\n  <triggers\/>\n  <authToken>ThisIsTheAPITokenToUse<\/authToken>\n  <disabled>false<\/disabled>\n<\/flow-definition>' | sudo su -c 'tee ~\/jobs\/@@{new_project_name}@@\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@\/builds\/legacyIds' - jenkins\n\necho \"Create @@{new_project_name}@@ App Deploy Job\"\nsudo su -c 'mkdir -p ~\/jobs\/@@{new_project_name}@@_deploy\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/@@{new_project_name}@@_deploy\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/@@{new_project_name}@@_deploy\/nextBuildNumber' - jenkins\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>ARTIFACTORY_IP<\/name>\n          <description><\/description>\n          <defaultValue>@@{Artifactory.address}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry.name}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>BUILD_NUMBER<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>APP_NAME<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry.app_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <script>import groovy.json.JsonSlurperClassic\nimport groovy.json.JsonOutput\n\nnode() {\n    stage(&apos;Deploy Application Via Calm&apos;){\n        echo &quot;Application deployment visual&quot;\n    }\n}\n\ndef response = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: false, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;]], ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@&apos;\n\nprintln(&quot;Status: &quot; + response.status)\n\/\/println(&quot;Content: &quot; + response.content)\n\ndef blueprint_spec = parseJSON(response.content)\ndef bp_index = 0\ndef var_index = 0\nblueprint_spec.remove(&apos;status&apos;)\nblueprint_spec[&apos;spec&apos;].remove(&apos;name&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;application_name&apos;] = REPO_NAME + &apos;@@{calm_random}@@Jenkins&apos; + BUILD_NUMBER.toString()\nblueprint_spec[&apos;spec&apos;][&apos;app_profile_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;app_profile&quot;, &quot;uuid&quot;: &quot;@@{app_profile_uuid}@@&quot;}&apos;)\nblueprint_spec[&apos;metadata&apos;][&apos;owner_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;user&quot;, &quot;uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;, &quot;name&quot;: &quot;admin&quot;}&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;].each  { profileKey, profileRow -&gt; \n    println(&quot;Profile: ${profileKey}&quot;); \n    profileKey[&apos;variable_list&apos;].each { variableKey, variableRow -&gt;\n        println(&quot;Variable: ${variableKey}&quot;); \n        if (variableKey[&apos;name&apos;] == &apos;build_number&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = BUILD_NUMBER.toString()\n        } else if (variableKey[&apos;name&apos;] == &apos;project_name&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = REPO_NAME\n        } else if (variableKey[&apos;name&apos;] == &apos;artifactory_ip&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = ARTIFACTORY_IP\n        } else if (variableKey[&apos;name&apos;] == &apos;docker_registry&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = DOCKER_REGISTRY\n        } else if (variableKey[&apos;name&apos;] == &apos;app_name&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = APP_NAME\n        }\n        var_index += 1;\n    }; \n    bp_index += 1;\n}\n\/\/println(&quot;Content: &quot; + blueprint_spec)\n\ndef payload = JsonOutput.toJson(blueprint_spec)\nprintln(&quot;Payload: &quot; + payload)\n\ndef result = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: true, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;], [maskValue: false, name: &apos;Accept&apos;, value: &apos;application\/json&apos;]], httpMode: &apos;POST&apos;, requestBody: payload, ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@\/launch&apos;\nprintln(&quot;Status: &quot; + response.status)\nprintln(&quot;Content: &quot; + response.content)\n\ndef parseJSON(json) {\n    return new groovy.json.JsonSlurperClassic().parseText(json)\n}\n<\/script>\n    <sandbox>true<\/sandbox>\n  <\/definition>\n  <triggers\/>\n  <disabled>false<\/disabled>\n<\/flow-definition>'  | sudo su -c 'tee ~\/jobs\/@@{new_project_name}@@_deploy\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@_deploy\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@_deploy\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@_deploy\/builds\/legacyIds' - jenkins","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initialize Workstation Git Repository","attrs":{"exit_status":[],"script":"echo \"Initialize DevOps Git Project\"\ngit clone git@@@{Gitolite.name}@@.@@{domain_name}@@:@@{new_project_name}@@.git\n\ncd @@{new_project_name}@@\n\ngit config user.name nutanix\ngit config user.email nutanix@@@{name}@@.@@{domain_name}@@\ngit config --global push.default matching\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart Jenkins Service","attrs":{"exit_status":[],"script":"sudo systemctl restart jenkins","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Download Version 1 Demo Code","attrs":{"exit_status":[],"script":"echo \"Get Demo Code\"\ncd @@{new_project_name}@@\nwget @@{new_code_seed_location}@@\/@@{new_code_seed}@@\ntar xvfz @@{new_code_seed}@@\nrm @@{new_code_seed}@@\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Wait for Restart","attrs":{"exit_status":[],"script":"echo 'Wait for Jenkins Instance Restart'\nsleep 30","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Git Hook","attrs":{"exit_status":[],"script":"echo 'StrictHostKeyChecking no' > ~\/.ssh\/config\necho \"Create Hook\"\nssh @@{Gitolite.address}@@ 'printf \"#!\/bin\/bash\\n\/usr\/bin\/curl --user admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080\/job\/@@{new_project_name}@@\/buildWithParameters?token=ThisIsTheAPITokenToUse\\n\" | sudo su -c \"tee ~\/repositories\/@@{new_project_name}@@.git\/hooks\/post-receive\" - git'\nssh @@{Gitolite.address}@@ 'sudo su -c \"chmod 775 ~\/repositories\/@@{new_project_name}@@.git\/hooks\/post-receive\" - git'\necho \"Complete Hook\"\nsudo usermod -s \/bin\/false jenkins","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create and Push Docker Images","attrs":{"exit_status":[],"script":"export DOCKER_REGISTRY=@@{Docker Registry.name}@@.@@{domain_name}@@\nexport PROJECT_NAME=@@{new_project_name}@@\necho \"Login into Docker Registry\"\ndocker login -u @@{Docker Registry Credential.username}@@ -p @@{Docker Registry Credential.secret}@@ $DOCKER_REGISTRY\ncd ~\/@@{new_project_name}@@\n\necho \"Build and Push Ansible Image\"\ndocker build -t ${DOCKER_REGISTRY}\/@@{new_project_name}@@\/ansible docker-ansible\/src\ndocker push ${DOCKER_REGISTRY}\/@@{new_project_name}@@\/ansible\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3a932271_runbook","main_task_local_reference":{"kind":"app_task","name":"efbcbb73_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"Name of the Git repository and corresponding Jenkins pipeline project to be created and connected.","data_type":"BASE","type":"LOCAL","name":"new_project_name","value":"demo","label":"Project Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"This is the name of the blueprint that will be deployed via the initial Jenkins pipeline project.","data_type":"BASE","type":"LOCAL","name":"new_app_deploy_blueprint","value":"Application Deployment Karbon Containers","label":"Blueprint Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"This is is the name of the gzipped tar file that contains the base code for the demo project. This could also be a baseline of a git repo layout if this were new project.","data_type":"BASE","type":"LOCAL","name":"new_code_seed","value":"cicd-demo-v2.tar.gz","label":"Code Base File","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"URL of the code base tar file to be downloaded.","data_type":"BASE","type":"LOCAL","name":"new_code_seed_location","value":"@@{initial_code_seed_location}@@","label":"Code Base URL","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"Add Pipeline"}],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"This is the name of the blueprint that will be deployed via the initial Jenkins pipeline project.","data_type":"BASE","type":"LOCAL","name":"initial_app_deploy_blueprint","value":"","label":"Blueprint Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"Name of the Git repository and corresponding Jenkins pipeline project to be created and connected.","data_type":"BASE","type":"LOCAL","name":"initial_project_name","value":"devops","label":"Project Name","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"This is is the name of the gzipped tar file that contains the base code for the demo project. This could also be a baseline of a git repo layout if this were new project.","data_type":"BASE","type":"LOCAL","name":"initial_code_seed","value":"devops.tar.gz","label":"Code Base File","is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"URL of the code base tar file to be downloaded.","data_type":"BASE","type":"LOCAL","name":"initial_code_seed_location","value":"https:\/\/shuchida-cicd.s3-ap-northeast-1.amazonaws.com","label":"Code Base URL","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"The IP Address of the Prism Central instance.","data_type":"BASE","type":"LOCAL","name":"pc_instance_ip","value":"","label":"Prism Central IP Address","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":true,"description":"Domain name used as suffix for FQDN. Entered similar to \"nutanix.lab\" or \"nutanix.com\".","data_type":"BASE","type":"LOCAL","name":"domain_name","value":"apjsme.local","label":"Domain Name","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"The public key that corresponds to the private key entered in the Nutanix credential.","data_type":"BASE","type":"SECRET","name":"nutanix_public_key","value":"UPviIIa6V2l4DNRbL8TfvwcqXuaPf7j7HbMR7wTku5nJ2WvcU\/pkgWeG\/0nqWh1B0KvQUeSU9VOVBq9TFd1ztZJjNpFy26TYQmuseze9XyJjCTmVXPbPQ1CnnlELAMFt+p4\/Hywu55p7O\/1lRw4Ex9i99KX+\/wJTA7\/TSuJd\/f3IDynZqjTCZRdqgf7d6FFYNCDLgDY5oV2AP0Nycxrzv7TvSr3\/3c2wgc\/vzBmVxVdtoy+bLMhjwEXsmTriXtELDUj7jAh4LtnzShRGVVCA6+WdMuMCwNbk3sdNT1M2GJ4b\/1TRc+RKmXg3xe+GbwsYrAylbQz24aW\/phyUIWShsWkahVlMDBzBn1NAaHjimK9wZhTHNg65fj7a4y5H9Kc2WSZzjygmujLynwgA6cfKVpvnVQUwtdOubCginMxtqooj63mPjbhckeE+gjuS\/ODg31F1Inkb7qiwSpGqFVCoi\/l\/qv9a+UC37Nvk6cOXQQspLHMC+c8A\/kyZ\/r5SEY8r4Gjzexxl\/47YLHBj72zIJvsx8QskMFm00RipbpfGUa+XVnVTuRTB9oSdTMtAJJU=:utf-8","label":"Nutanix Public Key","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"The public key that corresponds to the private key entered in the Jenkins Key credential.","data_type":"BASE","type":"SECRET","name":"jenkins_public_key","value":"7thiGiAioW6PYTGNDdy14vUmI9+\/cqRf8lx\/KBuzX7gsxj6TeFW5EULBLYxc9cPqwUPDpsetcNZEkhHcmmjovpDfYpaQhXMeINe8b7Xk\/yS8w8IGCc2kpO8Hu1eVhp72ib3\/y5XI9t0CMQX5KbcenH5v65KQnRy6y5ueLo8H9zxSIBCOJdspbmzaVJB\/A+pTL4f\/8tlCRqkrVcjgc2ElXG\/34CGznALZ4noi6lfNqru+7TEoiMWENXDeFna4JBjD8g6iEMTtpHf3eJlFUSpyH5m9cSHTeruKUOi6MLKqFg01wWZvHyoGlTQE77O7Fes\/vxi9bnXrpkKPOsGE0hkwyld04qFmCNYeQnOlShhS4H2TN0e1W\/3xeRQGigsNnmzfhRTYUxXavLfvNCeNHcD3Vjgz6BfplTuTCxgCfo4XYMm\/6piF7CSLM6lfkOCqh6FkoLD79DHvfw\/jJU43M+nqjjswnDXS20Gw7nCtLF\/e+i9KtdNIYXuHDdV1kdpOUthygkUcKmHjcsa7IQcrEcRMGAlBV34obrHUCGuMExTNj6KB91e6413ORY1Tj\/vRs+w=:utf-8","label":"Jenkins Public Key","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"The name of the Karbon cluster that will be used for containerized Kubernetes deployments.","data_type":"BASE","type":"LOCAL","name":"karbon_cluster_name","value":"","label":"Karbon Cluster Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"yourname","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"Nutanix"},"type":"USER"},"name":"shuchida-cicd-base"},"api_version":"3.0","metadata":{"last_update_time":"1573632522080565","kind":"blueprint","spec_version":3,"creation_time":"1573625724043754","name":"shuchida-cicd-base"}}